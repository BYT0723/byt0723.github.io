<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>golang-ants-tour</title>
    <link href="/20240705/golang-ants-tour/"/>
    <url>/20240705/golang-ants-tour/</url>
    
    <content type="html"><![CDATA[<h1 id="Ants"><a href="#Ants" class="headerlink" title="Ants"></a><a href="https://github.com/panjf2000/ants">Ants</a></h1><blockquote><p><strong><em>high-performance and low-cost goroutine pool</em></strong><br><strong><em>ä½¿ç”¨Golangç¼–å†™çš„ä½æˆæœ¬é«˜æ€§èƒ½çš„goroutineæ± </em></strong></p></blockquote><h2 id="æ± å­ç±»å‹"><a href="#æ± å­ç±»å‹" class="headerlink" title="æ± å­ç±»å‹"></a>æ± å­ç±»å‹</h2><ul><li>Pool</li><li>PoolWithFunc</li><li>MultiPool</li><li>MultiPoolWithFunc</li></ul><h2 id="æºç å¶å¾—è‡ªæ—‹é”"><a href="#æºç å¶å¾—è‡ªæ—‹é”" class="headerlink" title="æºç å¶å¾—è‡ªæ—‹é”"></a>æºç å¶å¾—è‡ªæ—‹é”<a href="https://github.com/panjf2000/ants/blob/313f136d004dc2497fcc58b0d844fb7d068565b7/internal/sync/spinlock.go#L13"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Copyright 2019 Andy Pan &amp; Dietoad. All rights reserved.</span><br><span class="hljs-comment">// Use of this source code is governed by an MIT-style</span><br><span class="hljs-comment">// license that can be found in the LICENSE file.</span><br><br><span class="hljs-keyword">package</span> sync<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;runtime&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;sync/atomic&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> spinLock <span class="hljs-type">uint32</span><br><br><span class="hljs-keyword">const</span> maxBackoff = <span class="hljs-number">16</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sl *spinLock)</span></span> Lock() &#123;<br>backoff := <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> !atomic.CompareAndSwapUint32((*<span class="hljs-type">uint32</span>)(sl), <span class="hljs-number">0</span>, <span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// Leverage the exponential backoff algorithm, see https://en.wikipedia.org/wiki/Exponential_backoff.</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; backoff; i++ &#123;<br>runtime.Gosched()<br>&#125;<br><span class="hljs-keyword">if</span> backoff &lt; maxBackoff &#123;<br>backoff &lt;&lt;= <span class="hljs-number">1</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sl *spinLock)</span></span> Unlock() &#123;<br>atomic.StoreUint32((*<span class="hljs-type">uint32</span>)(sl), <span class="hljs-number">0</span>)<br>&#125;<br><br><span class="hljs-comment">// NewSpinLock instantiates a spin-lock.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewSpinLock</span><span class="hljs-params">()</span></span> sync.Locker &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span>(spinLock)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸¤ä¸ªå…³é”®ç‚¹"><a href="#ä¸¤ä¸ªå…³é”®ç‚¹" class="headerlink" title="ä¸¤ä¸ªå…³é”®ç‚¹"></a>ä¸¤ä¸ªå…³é”®ç‚¹</h3><ul><li>æŒ‡æ•°é¿è®©</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">if</span> backoff &lt; maxBackoff &#123;<br>  backoff &lt;&lt;= <span class="hljs-number">1</span>  <span class="hljs-comment">// å½“å°äºæœ€å¤§é¿è®©æ¬¡æ•°ï¼Œå·¦ç§»ä¸€ä½(å³ä¸º2^(n+1))</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>runtime.Gosched</code><blockquote><p>runtime.Gosched() æ˜¯ä¸€ä¸ªç”¨äºè®©å‡ºå½“å‰ goroutine çš„è°ƒåº¦å™¨ï¼Œä»¥ä¾¿è®©å…¶ä»– goroutine è¿è¡Œçš„å‡½æ•°ã€‚å®ƒä¸ä¼šæ˜ç¡®æŒ‡å®šè®©å‡º CPU çš„æ—¶é—´ï¼Œè€Œæ˜¯å°†å½“å‰ goroutine æ”¾å›åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œå…è®¸ Go è°ƒåº¦å™¨é€‰æ‹©è¿è¡Œå…¶ä»–å¯è¿è¡Œçš„ goroutineã€‚å®é™…ä¸Šï¼Œå®ƒè®©å‡ºçš„æ˜¯è°ƒåº¦æœºä¼šï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ—¶é—´ç‰‡ã€‚</p><ul><li>è®©å‡ºè°ƒåº¦ï¼šå½“å‰ goroutine å°†è‡ªå·±æ”¾å›åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”å¯èƒ½ä¼šç«‹å³è¢«é‡æ–°è°ƒåº¦è¿è¡Œï¼Œæˆ–è€…åœ¨å…¶ä»– goroutine è¿è¡Œä¹‹åå†è¢«è°ƒåº¦è¿è¡Œã€‚</li><li>ä¸é˜»å¡ï¼šruntime.Gosched() ä¸ä¼šé˜»å¡å½“å‰ goroutineï¼Œè€Œæ˜¯è®©å‡ºè°ƒåº¦ä¹‹åç»§ç»­æ‰§è¡Œã€‚</li></ul></blockquote></li></ul><h4 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h4><p>time.Sleep ä¸ runtime.Gosched çš„å¯¹æ¯”</p><ul><li>time.Sleep:<ul><li>è®©å‡º CPU æ—¶é—´ç‰‡å¹¶è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°æŒ‡å®šçš„æ—¶é—´ç»“æŸã€‚</li><li>ç¡çœ æ—¶é—´å¯ä»¥éå¸¸çŸ­ï¼ˆå¦‚ time.Nanosecondï¼‰ï¼Œä¹Ÿå¯ä»¥æ¯”è¾ƒé•¿ã€‚</li><li>åœ¨ç¡çœ æœŸé—´ï¼Œè¯¥ goroutine ä¸ä¼šè¢«è°ƒåº¦è¿è¡Œã€‚</li></ul></li><li>runtime.Gosched:<ul><li>ç«‹å³è®©å‡ºå½“å‰ goroutine çš„è°ƒåº¦æƒï¼Œä½†æ²¡æœ‰æŒ‡å®šå…·ä½“çš„æ—¶é—´ã€‚</li><li>å½“å‰ goroutine ä¼šè¢«æ”¾å›è°ƒåº¦é˜Ÿåˆ—ï¼Œè°ƒåº¦å™¨å¯ä»¥ç«‹å³æˆ–è€…ç¨åé‡æ–°è°ƒåº¦è¯¥ goroutineã€‚</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
      <category>Goroutine Pool</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Goroutine</tag>
      
      <tag>Pool</tag>
      
      <tag>Ants</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goå†…å­˜å¯¹é½ï¼šç»“æ„ä½“ä¸­0å­—èŠ‚å­—æ®µå¡«å……</title>
    <link href="/20240310/golang-memory-align-zeroBytes-padding/"/>
    <url>/20240310/golang-memory-align-zeroBytes-padding/</url>
    
    <content type="html"><![CDATA[<h3 id="1-é—®é¢˜"><a href="#1-é—®é¢˜" class="headerlink" title="1. é—®é¢˜"></a>1. é—®é¢˜</h3><p>è§‚çœ‹ä»¥ä¸‹ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;unsafe&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> S1 <span class="hljs-keyword">struct</span> &#123;<br>a <span class="hljs-keyword">struct</span>&#123;&#125;<br>b <span class="hljs-type">int8</span><br>c <span class="hljs-type">int64</span><br>&#125;<br><br><span class="hljs-keyword">type</span> S2 <span class="hljs-keyword">struct</span> &#123;<br>a <span class="hljs-type">int8</span><br>b <span class="hljs-type">int64</span><br>c <span class="hljs-keyword">struct</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> (<br>s1 S1<br>s2 S2<br>)<br>fmt.Printf(<span class="hljs-string">&quot;unsafe.Sizeof(s1): %v\n&quot;</span>, unsafe.Sizeof(s1))<br>fmt.Printf(<span class="hljs-string">&quot;unsafe.Sizeof(s2): %v\n&quot;</span>, unsafe.Sizeof(s2))<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="1-1-åˆ†æ"><a href="#1-1-åˆ†æ" class="headerlink" title="1.1 åˆ†æ"></a>1.1 åˆ†æ</h5><ul><li><p>S1</p><ol><li>aå­—æ®µä¸º<code>struct&#123;&#125;</code>,ä¸å å†…å­˜ï¼Œ0å­—èŠ‚</li><li>bå­—æ®µä¸º<code>int8</code>,å¯¹é½é•¿åº¦1, å 1å­—èŠ‚</li><li>cå­—æ®µä¸º<code>int64</code>,å¯¹é½é•¿åº¦8,å‰ä¸¤ä¸ªå­—æ®µåªå ç”¨äº†1å­—èŠ‚ï¼Œæ‰€ä»¥å¡«å……7å­—èŠ‚ï¼Œå¯¹é½åˆ°å…«å­—èŠ‚ä½</li></ol><p>æ‰€ä»¥S1å ç”¨16å­—èŠ‚</p></li><li><p>S2</p><ol><li>aå­—æ®µä¸º<code>int8</code>,å¯¹é½é•¿åº¦1, å 1å­—èŠ‚</li><li>bå­—æ®µä¸º<code>int64</code>,å¯¹é½é•¿åº¦8,aå­—æ®µåªå ç”¨äº†1å­—èŠ‚ï¼Œæ‰€ä»¥å¡«å……7å­—èŠ‚ï¼Œå¯¹é½åˆ°å…«å­—èŠ‚ä½</li><li>aå­—æ®µä¸º<code>struct&#123;&#125;</code>,ä¸å å†…å­˜ï¼Œ0å­—èŠ‚</li></ol><p>æ‰€ä»¥S2å ç”¨16å­—èŠ‚</p></li></ul><p><strong>çœŸçš„å¯¹å—ï¼Ÿ</strong>,çœ‹çœ‹è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unsafe</span>.Sizeof(s1): <span class="hljs-number">16</span><br><span class="hljs-attribute">unsafe</span>.Sizeof(s2): <span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹golangä»“åº“ä¸­çš„è¿™ä¸ª<a href="https://github.com/golang/go/issues/9401">issue 9401</a>,å»ºè®®è‡ªå·±çœ‹æ¯”è¾ƒå¥½ã€‚</p><p>æœºç¿»ä¸€ä¸‹<br><img src="https://i.imgur.com/K3SgHlB.png" alt="issue9401"><br>é‚£ä¹ˆå½“0å­—ç¬¦å­—æ®µåœ¨ç»“æ„ä½“æœ€åæ—¶ï¼Œå¤šå‡ºçš„ä¸€ä¸ªç»“æ„ä½“å¯¹é½é•¿åº¦ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ç»“æ„ä½“æŒ‡é’ˆä¹‹ä¹¡ç»“æ„ä½“å¤–éƒ¨ï¼Œå³æ— æ•ˆæŒ‡é’ˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Memory Align</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>archlinux-wine-wechat-install</title>
    <link href="/20240310/archlinux-wine-wechat-install/"/>
    <url>/20240310/archlinux-wine-wechat-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ˜…ç°åœ¨è…¾è®¯å·²æ¨å‡ºwechat for linux, ä½¿ç”¨yayæˆ–å…¶ä»–åŒ…ç®¡ç†å·¥å…·ä»aurä¸­å®‰è£…wechatå³å¯</p></blockquote><h3 id="1-å®‰è£…æ–¹æ¡ˆ"><a href="#1-å®‰è£…æ–¹æ¡ˆ" class="headerlink" title="1. å®‰è£…æ–¹æ¡ˆ"></a>1. å®‰è£…æ–¹æ¡ˆ</h3><ul><li><code>wine-for-wechat</code>é…åˆ<code>wine-wechat-setup</code>æ— è„‘çˆ½,è¿™æ˜¯archlinuxcnæºä¸­çš„åŒ…</li></ul><h3 id="2-å‡†å¤‡"><a href="#2-å‡†å¤‡" class="headerlink" title="2. å‡†å¤‡"></a>2. å‡†å¤‡</h3><h4 id="2-1-ArchlinuxCNæºé…ç½®"><a href="#2-1-ArchlinuxCNæºé…ç½®" class="headerlink" title="2.1 ArchlinuxCNæºé…ç½®"></a>2.1 ArchlinuxCNæºé…ç½®</h4><p>æ ¹æ®<a href="https://wiki.archlinux.org/title/Unofficial_user_repositories#archlinuxcn">archlinuxcn</a>å®Œæˆarchlinuxcnæºé…ç½®ï¼Œç„¶åä½¿ç”¨<code>sudo pacman -Syu</code>æ›´æ–°æº</p><h4 id="2-2-ä¸‹è½½Wechatå®‰è£…åŒ…"><a href="#2-2-ä¸‹è½½Wechatå®‰è£…åŒ…" class="headerlink" title="2.2 ä¸‹è½½Wechatå®‰è£…åŒ…"></a>2.2 ä¸‹è½½Wechatå®‰è£…åŒ…</h4><p>ä¸‹è½½æœ€æ–°çš„<a href="https://pc.weixin.qq.com/">wechat 64ä½</a>å®‰è£…åŒ…</p><span id="more"></span><h4 id="2-3-ä¸‹è½½riched20-dll"><a href="#2-3-ä¸‹è½½riched20-dll" class="headerlink" title="2.3 ä¸‹è½½riched20.dll"></a>2.3 ä¸‹è½½riched20.dll</h4><p>ä¸‹è½½<a href="https://www.dll-files.com/download/5681d07a869a1a11020f7d28f7d621e2/riched20.dll.html">riched20.dll</a>,å®‰è£…æœ€æ–°çš„64ç‰ˆæœ¬<br><img src="https://i.imgur.com/W435LZd.png" alt="riched20 x64"></p><h3 id="3-å®‰è£…"><a href="#3-å®‰è£…" class="headerlink" title="3. å®‰è£…"></a>3. å®‰è£…</h3><ul><li>å®‰è£…wineå’Œæ‰€éœ€ç¯å¢ƒ<blockquote><p><code>sudo pacman -S wine-for-wechat wine-wechat-setup wine-gecko winetricks wine-mono</code></p></blockquote></li><li>ä¸ºwineå®¹å™¨å®‰è£…fakechineseå­—ä½“ï¼Œå¦‚æœä¸å®‰è£…ï¼Œä½ ä¼šçœ‹åˆ°æ–¹å—å­—<blockquote><p><code>WINEPREFIX=~/.local/lib/wine-wechat/default winetricks fakechinese</code></p></blockquote></li><li>å®‰è£…æ–°çš„riched20.dll<ol><li>å¤‡ä»½æ—§çš„<code>riched20.dll</code><blockquote><p><code>mv ~/.local/lib/wine-wechat/default/drive_c/windows/system32/riched20.dll ~/.local/lib/wine-wechat/default/drive_c/windows/system32/riched20_old.dll</code></p></blockquote></li><li>è§£å‹zipæ–‡ä»¶<br>å¦‚æœæ²¡æœ‰unzip,ä½¿ç”¨<code>sudo pacman -S unzip</code>å®‰è£…ä¸€ä¸‹<blockquote><p><code>unzip riched20.zip</code></p></blockquote></li><li>å°†æ–°çš„dllæ–‡ä»¶æ”¾å…¥system32ä¸­<blockquote><p><code>cp riched20.dll ~/.local/lib/wine-wechat/default/drive_c/windows/system32/</code></p></blockquote></li></ol></li><li>å®‰è£…wechat<blockquote><p><code>wechat -i &lt;wechatå®‰è£…åŒ…è·¯å¾„&gt;</code></p></blockquote></li></ul><h3 id="4-å‰©ä½™é—®é¢˜"><a href="#4-å‰©ä½™é—®é¢˜" class="headerlink" title="4.å‰©ä½™é—®é¢˜"></a>4.å‰©ä½™é—®é¢˜</h3><ul><li>è®¾ç½®é¡µé¢çš„å­—ä½“è¿˜æ˜¯æœ‰æ–¹å—<br><img src="https://i.imgur.com/Gf3yy1T.png" alt="setting"></li><li>è®¢é˜…å·çš„å†…å®¹æ— æ³•å±•ç¤º</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Arch</tag>
      
      <tag>Wine</tag>
      
      <tag>Wechat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goä¼˜é›…é‡å¯</title>
    <link href="/20231126/golang-stateful-rolling-restart/"/>
    <url>/20231126/golang-stateful-rolling-restart/</url>
    
    <content type="html"><![CDATA[<h4 id="1-åº”ç”¨åœºæ™¯"><a href="#1-åº”ç”¨åœºæ™¯" class="headerlink" title="1. åº”ç”¨åœºæ™¯"></a>1. åº”ç”¨åœºæ™¯</h4><p>ä¾‹å¦‚å½“æˆ‘ä»¬æ›´æ–°äº†é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æƒ³åœæ­¢ç¨‹åºé‡å¯</p><h4 id="2-å®ç°æ€æƒ³"><a href="#2-å®ç°æ€æƒ³" class="headerlink" title="2. å®ç°æ€æƒ³"></a>2. å®ç°æ€æƒ³</h4><p>åœ¨æˆ‘ä»¬æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶æ›´æ”¹æ—¶ï¼Œè¿›è¡Œè¿›ç¨‹æ›¿æ¢ï¼Œä½†å¦‚æœæˆ‘ä»¬å¼€å¯å­è¿›ç¨‹ï¼Œæ€æ­»çˆ¶è¿›ç¨‹ï¼Œä¼šäº§ç”Ÿå­¤å„¿è¿›ç¨‹</p><span id="more"></span><h4 id="3-ç ´å±€"><a href="#3-ç ´å±€" class="headerlink" title="3. ç ´å±€"></a>3. ç ´å±€</h4><p>æŸ¥è¯¢èµ„æ–™ï¼Œå‘ç°äº†<code>syscall.Exec</code>å‡½æ•°ï¼Œæ–‡æ¡£ä¸­è¿™æ ·æå†™åˆ°<code>Exec invokes the execve(2) system call.</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>execve(2)</code>çš„ç³»ç»Ÿè°ƒç”¨æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><blockquote><p>execve() executes the program referred to by pathname. This causes the program that is currently being run by the calling process to be replaced with a new program, with newly initialized stack, heap, and (initialized and uninitialized) data segments.<br>ç¿»è¯‘ä¸€ä¸‹ï¼š<br>execve() æ‰§è¡Œè·¯å¾„åå¼•ç”¨çš„ç¨‹åºã€‚ è¿™ä¼šå¯¼è‡´å½“å‰æ­£åœ¨ç”±è°ƒç”¨è¿›ç¨‹è¿è¡Œçš„ç¨‹åºè¢«æ–°ç¨‹åºæ›¿æ¢ï¼Œæ–°ç¨‹åºå…·æœ‰æ–°åˆå§‹åŒ–çš„å †æ ˆã€å †å’Œï¼ˆå·²åˆå§‹åŒ–å’Œæœªåˆå§‹åŒ–çš„ï¼‰æ•°æ®æ®µã€‚</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;syscall&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">if</span> err := syscall.Exec(<span class="hljs-string">&quot;/bin/ls&quot;</span>, []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;-l&quot;</span>, <span class="hljs-string">&quot;-a&quot;</span>&#125;, os.Environ()); err != <span class="hljs-literal">nil</span> &#123;<br>log.Println(<span class="hljs-string">&quot;syscall.ExecæŠ¥é”™äº†: &quot;</span>, err.Error())<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;æˆ‘è¿˜æ²¡ä¸Šè½¦å‘¢ã€‚ã€‚ã€‚ã€‚&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/djwXFwO.png" alt="output1"><br><img src="https://i.imgur.com/dVbXoQf.png" alt="output2"></p><p>å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬æˆåŠŸæ‰§è¡Œ<code>syscall.Exec</code>æ—¶ï¼Œæˆ‘ä»¬çš„ç¨‹åºè¢«æ›¿æ¢æˆäº†<code>ls -al</code>ï¼Œæ‰€ä»¥æœ€åä¸€è¡Œè¾“å‡ºè¯­å¥å¹¶æ²¡æœ‰æ‰§è¡Œ</p><hr><p>chatgptå¯¹äº<code>syscall.Exec</code>çš„å›ç­”<br><img src="https://imgur.com/ZXAvDht.png" alt="chatgpt syscall exec"></p>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note</title>
    <link href="/20231106/note/"/>
    <url>/20231106/note/</url>
    
    <content type="html"><![CDATA[<h3 id="æœ¬æ–‡ä»¥åŠè¯„è®ºè®°å½•äº†å¹³æ—¶çš„ä¸€äº›é—®é¢˜"><a href="#æœ¬æ–‡ä»¥åŠè¯„è®ºè®°å½•äº†å¹³æ—¶çš„ä¸€äº›é—®é¢˜" class="headerlink" title="æœ¬æ–‡ä»¥åŠè¯„è®ºè®°å½•äº†å¹³æ—¶çš„ä¸€äº›é—®é¢˜"></a>æœ¬æ–‡ä»¥åŠè¯„è®ºè®°å½•äº†å¹³æ—¶çš„ä¸€äº›é—®é¢˜</h3><ul><li><a href="https://github.com/BYT0723/music-downloader">music-downloader</a><blockquote><ul><li>music-downloaderçš„æ­Œæ›²åè¿˜æ˜¯ä¼šå‡ºç°å­—ç¬¦é”™è¯¯ï¼Œç»§ç»­æ’æŸ¥</li><li>DONE: qq-music-apiä¸­æ²¡æœ‰checkæ˜¯å¦è·å–åˆ°æ­Œè¯</li></ul></blockquote></li></ul>]]></content>
    
    
    <categories>
      
      <category>common</category>
      
    </categories>
    
    
    <tags>
      
      <tag>common</tag>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Archå®‰è£…Dwm</title>
    <link href="/20230610/archlinux-xorg-dwm/"/>
    <url>/20230610/archlinux-xorg-dwm/</url>
    
    <content type="html"><![CDATA[<h3 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h3><p>ä½ éœ€è¦ç¡®ä¿ä½ å·²ç»å®‰è£…å¥½äº† Arch æˆ–å…¶ä»–å‘è¡Œç‰ˆçš„ Linux,å¹¶ä¸”å·²ç»æ¥å…¥äº’è”ç½‘ã€é…ç½®å¥½äº†ä½ çš„ <code>pacman.conf</code> å’Œ <code>mirrorlist</code></p><blockquote><p>Tips: å¦‚æœæ‚¨å·²æ¥è§¦è¿‡å…¶ä»–æ¡Œé¢ç®¡ç†å™¨ï¼Œå¯ç›´æ¥è·³è½¬è‡³<a href="#4%E5%AE%89%E8%A3%85">å®‰è£…</a></p></blockquote><h3 id="2-å®‰è£…-Xorg"><a href="#2-å®‰è£…-Xorg" class="headerlink" title="2.å®‰è£… Xorg"></a>2.å®‰è£… Xorg</h3><p>Xorg ï¼ˆé€šå¸¸ç®€ç§°ä¸º X ï¼‰æ˜¯ Linux ç”¨æˆ·ä¸­æœ€æµè¡Œçš„æ˜¾ç¤ºæœåŠ¡å™¨ã€‚ å®ƒæ— å¤„ä¸åœ¨ï¼Œä½¿å…¶æˆä¸º GUI åº”ç”¨ç¨‹åºæ°¸è¿œå­˜åœ¨çš„å¿…è¦æ¡ä»¶ï¼Œä»è€Œå¯¼è‡´å¤§å¤šæ•°å‘è¡Œç‰ˆçš„å¤§é‡é‡‡ç”¨ã€‚<a href="https://wiki.archlinux.org/title/Xorg">wiki</a><br>xorg æ˜¯ dwm ä¹ƒè‡³å¤§å¤šæ•°æ¡Œé¢ç¯å¢ƒçš„åŸºç¡€(hyprrland é™¤å¤–).</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo pacman -S xorg xorg-server xorg-apps<br></code></pre></td></tr></table></figure><blockquote><p>xorg-apps ä¸­åŒ…æ‹¬äº†å¾ˆå¤šæœ‰ç”¨çš„å·¥å…·ï¼Œä¾‹å¦‚<code>xrandr</code>ã€<code>xprop</code>ã€<code>xmodmap</code>ã€<code>xsetroot</code></p></blockquote><span id="more"></span><h3 id="3-é©±åŠ¨å®‰è£…"><a href="#3-é©±åŠ¨å®‰è£…" class="headerlink" title="3.é©±åŠ¨å®‰è£…"></a>3.é©±åŠ¨å®‰è£…</h3><ol><li>æ˜¾å¡</li></ol><ul><li>intel <code>xf86-video-intel</code></li><li>amd <code>xf86-video-amdgpu</code></li><li>nvidia <code>nvidia-dkms</code></li></ul><ol start="2"><li>è¾“å…¥è®¾å¤‡</li></ol><ul><li><code>xf86-input-libinput</code></li><li>è§¦æ‘¸æ¿<code>xf86-input-synaptics</code></li></ul><p>è¿™æ˜¯é…ç½®å‡å¯åœ¨<code>/etc/X11/xorg.conf.d/</code>ä¸‹é…ç½®,ç»†è§<a href="https://wiki.archlinux.org/title/Xorg#Input_devices">xorg wiki</a>,æ ¹æ®è¾“å…¥è®¾å¤‡åˆ†ç±»ï¼ŒæŸ¥çœ‹ wiki è¿›è¡Œé…ç½®</p><blockquote><p>é»˜è®¤å¯ä¸é…ç½®ï¼Œåœ¨å¯åŠ¨åå‘ç°è®¾å¤‡ä¸å¯ç”¨å†é…ç½®ä¹Ÿå¯</p></blockquote><h3 id="4-å®‰è£…"><a href="#4-å®‰è£…" class="headerlink" title="4.å®‰è£…"></a>4.å®‰è£…</h3><h4 id="4-1-å®‰è£…-Dwm"><a href="#4-1-å®‰è£…-Dwm" class="headerlink" title="4.1 å®‰è£… Dwm"></a>4.1 å®‰è£… Dwm</h4><blockquote><p>Tips: å¦‚æœä½ å®‰è£…çš„è¿‡ç¨‹ä¸­éœ€è¦å¤§é‡ä½¿ç”¨ github æˆ–å›½å¤–çš„èµ„æºï¼Œå»ºè®®å…ˆå®‰è£…å¹¶é…ç½®å¥½ç³»ç»Ÿä»£ç†.</p></blockquote><ul><li>ä» suckless.org ä»æ‹‰å–æœ€æ–°çš„ dwm</li><li>ä½¿ç”¨ç°æˆçš„<a href="https://github.com/BYT0723/dwm">github</a>æˆ–<a href="https://gitee.com/BYT0723/dwm">gitee</a></li></ul><p>å› ä¸ºæˆ‘çš„ç°æˆçš„,æ‰€ä»¥æˆ‘é€‰æ‹©ç°æˆçš„.å¦‚æœä½ ä¸€æ¬¡æ¥è§¦ Dwm æˆ–å¹³é“ºå¼çª—å£ç®¡ç†å™¨ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°çš„ Dwm,ç„¶åå»å®‰è£…è¡¥ä¸ï¼Œæˆ–è‡ªä¸»ä¿®æ”¹ï¼Œè™½ç„¶ä½¿ç”¨è¿‡ç¨‹ä¼šæ›²æŠ˜ä¸€äº›ï¼Œä½†ä½ ä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹</p><ol><li>æ‹‰å– Dwm</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/BYT0723/dwm.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ— æ³•è®¿é—®githubçš„æœ‹å‹å¯</span><br>git clone https://gitee.com/BYT0723/dwm.git<br></code></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘å®‰è£…</li></ol><blockquote><p>Tips: æ­¤æ­¥æ“ä½œéœ€è¦<code>make</code>,å¦‚æœæ²¡æœ‰çš„æœ‹å‹å¯ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·è¿›è¡Œå®‰è£…</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd dwm<br>sudo make clean install<br></code></pre></td></tr></table></figure><p>dwm å°†ä¼šè¢«å®‰è£…åˆ°<code>/usr/local/bin/</code>ä¸‹</p><h4 id="4-2-ç»ˆç«¯å®‰è£…"><a href="#4-2-ç»ˆç«¯å®‰è£…" class="headerlink" title="4.2 ç»ˆç«¯å®‰è£…"></a>4.2 ç»ˆç«¯å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/BYT0723/st.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ— æ³•è®¿é—®githubçš„æœ‹å‹å¯</span><br>git clone https://gitee.com/BYT0723/st.git<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä»¥åŠ</span><br>sudo pacman -S alacritty<br></code></pre></td></tr></table></figure><p>å…±å®‰è£…äº†ä¸¤ä¸ªç»ˆç«¯<code>st</code>å’Œ<code>alacritty</code>,st å’Œ dwm æ›´é…ï¼Œä½†æœ€ä»¤äººçª’æ¯çš„å°±æ˜¯çª—å£å¤§å°æ”¹å˜æ—¶å†…å®¹ä¼šä¸¢å¤±;alacritty æ˜¯ rust ç¼–å†™çš„ï¼Œå¹¶ä½¿ç”¨äº† gpu åŠ é€Ÿï¼Œé€Ÿåº¦æ›´å¿«.<br>åœ¨æˆ‘çš„ Dwm é…ç½®ä¸­ st æä¾›æµ®åŠ¨ç»ˆç«¯ï¼Œè€Œ alacritty ä¾›æ—¥å¸¸ä½¿ç”¨ã€‚alacritty æ²¡æœ‰è¿å­—åŠŸèƒ½,st æœ‰è¿å­—åŠŸèƒ½.</p><h4 id="4-3-è„šæœ¬å®‰è£…"><a href="#4-3-è„šæœ¬å®‰è£…" class="headerlink" title="4.3 è„šæœ¬å®‰è£…"></a>4.3 è„šæœ¬å®‰è£…</h4><blockquote><p>Dwm ä¸­æ¶‰åŠè¾ƒå¤šçš„ shell è„šæœ¬ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–å®ç°æ–¹æ³•ï¼Œå„ä½å¯è‡ªè¡Œæ¢ç´¢</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/BYT0723/scripts.git ~/.dwm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ— æ³•è®¿é—®githubçš„æœ‹å‹å¯</span><br>git clone https://gitee.com/BYT0723/scripts.git ~/.dwm<br></code></pre></td></tr></table></figure><blockquote><p>é‡ç‚¹ï¼šæŸ¥çœ‹<code>~/.dwm/README.md</code>, å®‰è£…å¥½æ‰€æœ‰éœ€è¦çš„ä¾èµ–å’Œå­—ä½“ç­‰ï¼Œä¼šè®©ä½ æœ‰ä¸€ä¸ªè¾ƒå¥½çš„å¯åŠ¨ä½“éªŒ</p></blockquote><h3 id="5-å¯åŠ¨"><a href="#5-å¯åŠ¨" class="headerlink" title="5.å¯åŠ¨"></a>5.å¯åŠ¨</h3><p>ä»¥ä¸‹ä¸¤ç§ä»»é€‰å…¶ä¸€</p><h4 id="5-1-ä½¿ç”¨-startx"><a href="#5-1-ä½¿ç”¨-startx" class="headerlink" title="5.1 ä½¿ç”¨ startx"></a>5.1 ä½¿ç”¨ startx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœä½ çš„~/.xinitrcæ–‡ä»¶ä¸å­˜åœ¨æˆ–å†…å®¹ä¸ºç©º</span><br>echo &quot;exec dwm &gt;&gt; ~/.dwm.log&quot; &gt; .xinitrc<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦åˆ™</span><br>echo &quot;exec dwm &gt;&gt; ~/.dwm.log&quot; &gt;&gt; .xinitrc<br></code></pre></td></tr></table></figure><p>ä¹‹ååœ¨<code>$HOME</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>startx</code>å³å¯</p><h4 id="5-2-ä½¿ç”¨å¯åŠ¨ç®¡ç†å™¨"><a href="#5-2-ä½¿ç”¨å¯åŠ¨ç®¡ç†å™¨" class="headerlink" title="5.2 ä½¿ç”¨å¯åŠ¨ç®¡ç†å™¨"></a>5.2 ä½¿ç”¨å¯åŠ¨ç®¡ç†å™¨</h4><p>ç»è¿‡æœ¬äººä½¿ç”¨ï¼ŒåŒæ˜¾å¡ç”¨æˆ·ä½¿ç”¨ optimius-manager é…åˆå¯åŠ¨ç®¡ç†å™¨æ•ˆæœæ›´ä½³. é…ç½®æ›´è½»ä¾¿ç®€å•</p><ol><li>å®‰è£… lightdm</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo pacman -S lightdm lightdm-gtk-greeter lightdm-gtk-greeter-setting<br></code></pre></td></tr></table></figure><ol start="2"><li>é…ç½® lightdm</li></ol><p>é…ç½® greeter,çœ‹æ¸…ï¼Œæ˜¯<code>[Seat:*]</code>ä¸‹çš„é…ç½®,å°†å¯¹åº”çš„é…ç½®é¡¹ä¿®æ”¹ä¸ºå¦‚ä¸‹å€¼</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Seat:*]</span><br><span class="hljs-attr">greeter-session</span>=lightdm-gtk-greeter<br></code></pre></td></tr></table></figure><ol start="3"><li>æ·»åŠ  Dwm</li></ol><p>å°†å¦‚ä¸‹å¦‚å†…å®¹æ·»åŠ åˆ°<code>/usr/share/xsessions/dwm.desktop</code>ä¸­å¹¶ä¿å­˜</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Desktop Entry]</span><br><span class="hljs-attr">Type</span>=XSession<br><span class="hljs-attr">Exec</span>=/usr/local/bin/dwm<br><span class="hljs-attr">TryExec</span>=/usr/local/bin/dwm<br><span class="hljs-attr">DesktopNames</span>=Dwm<br><span class="hljs-attr">Name</span>=Dwm<br><span class="hljs-attr">Comment</span>=Dynamic Window Manager<br></code></pre></td></tr></table></figure><ol start="4"><li>å¯åŠ¨</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¼€æœºå¯åŠ¨</span><br>sudo systemctl enable lightdm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>sudo systemctl start lightdm<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä½ å°±å¯çœ‹åˆ°ç®¡ç†å™¨ç•Œé¢ï¼Œç™»å½•å³å¯è¿›å…¥ Dwm</p><h3 id="6-å…¶ä»–é…ç½®-å¯é€‰"><a href="#6-å…¶ä»–é…ç½®-å¯é€‰" class="headerlink" title="6. å…¶ä»–é…ç½®(å¯é€‰)"></a>6. å…¶ä»–é…ç½®(å¯é€‰)</h3><h4 id="6-1-é…ç½®xorgçš„keymapæ˜ å°„"><a href="#6-1-é…ç½®xorgçš„keymapæ˜ å°„" class="headerlink" title="6.1 é…ç½®xorgçš„keymapæ˜ å°„"></a>6.1 é…ç½®xorgçš„keymapæ˜ å°„</h4><p>ç¼–è¾‘<code>/etc/X11/xorg.conf.d/00-keyboard.conf</code>æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xf86conf">Section &quot;InputClass&quot;<br>        Identifier &quot;system-keyboard&quot;<br>        MatchIsKeyboard &quot;on&quot;<br>        Option &quot;XkbLayout&quot; &quot;us&quot;<br>        Option &quot;XkbModel&quot; &quot;pc104&quot;<br>        Option &quot;AutoRepeat&quot; &quot;250 50&quot;<br>        Option &quot;XkbOptions&quot; &quot;caps:swapescape,altwin:swap_lalt_lwin&quot;<br>EndSection<br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li><code>AutoRepeat</code>è®¾ç½®è§¦é”®é¢‘ç‡</li><li><code>XkbOptions</code>è®¾ç½®é”®ç›˜é”®ä½åˆ‡æ¢ï¼Œå…¶ä¸­<code>caps:swapescape</code>ä»£è¡¨äº¤æ¢å¤§å°å†™é”å®šå’ŒEsc, <code>altwin:swap_lalt_lwin</code>ä»£è¡¨äº¤æ¢Logoé”®(Win)å’Œå·¦Alté”®,<br>å…·ä½“å…¶ä»–é”®ä½å¯æŸ¥çœ‹<code>/usr/share/X11/xkb/rules/base.lst</code></li></ul><h4 id="6-2-é…ç½®ç³»ç»Ÿä»£ç†"><a href="#6-2-é…ç½®ç³»ç»Ÿä»£ç†" class="headerlink" title="6.2 é…ç½®ç³»ç»Ÿä»£ç†"></a>6.2 é…ç½®ç³»ç»Ÿä»£ç†</h4><p>è§<a href="/20230315/archlinux-system-proxy/">ArchLinuxç³»ç»Ÿä»£ç†</a>, å¦‚æœå„ä½æœ‰å…¶ä»–çš„æ›´ä¼˜æ›´ç®€ä¾¿çš„æ–¹æ¡ˆå¯è¡¥å……</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Arch</tag>
      
      <tag>Linux</tag>
      
      <tag>Dwm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golang_context</title>
    <link href="/20230526/golang-context/"/>
    <url>/20230526/golang-context/</url>
    
    <content type="html"><![CDATA[<p>éƒ¨åˆ†åˆå­¦è€…ä½¿ç”¨webæ¡†æ¶æ—¶ä¼šå‘ç°æ¯ä¸ªhandleréƒ½ä¼šä¼ å…¥ä¸€ä¸ªcontextï¼Œä½†å¹¶æ²¡æœ‰æ·±ç©¶ä»–çš„ä½œç”¨ï¼Œç”šè‡³ç›´æ¥ä¼ å…¥ä¸€ä¸ª<code>context.Background()</code>è‰è‰äº†äº‹ã€‚æœ¬æ–‡ç»“åˆæˆ‘åœ¨å·¥ä½œä¸­çš„å®é™…åœºæ™¯ï¼Œç›˜ç‚¹ä¸‹contextçš„ä½¿ç”¨</p><h4 id="1-æ§åˆ¶goroutine"><a href="#1-æ§åˆ¶goroutine" class="headerlink" title="1. æ§åˆ¶goroutine"></a>1. æ§åˆ¶goroutine</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;sync&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon1()<br>&#125;()<br><br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon2()<br>&#125;()<br><br>wg.Wait()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon1</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å¼€å¯8080ç«¯å£tcpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon2</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// å¼€å¯8080ç«¯å£udpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬åœ¨<code>main</code>å‡½æ•°ä¸­å¯åŠ¨äº†ä¸¤ä¸ªå®ˆæŠ¤åç¨‹ï¼Œå¹¶ä½¿ç”¨<code>WaitGroup</code>ç­‰å¾…goroutineç»“æŸï¼Œä½†ç”±äºdaemonä¸­ç›‘å¬å¹¶å¤„ç†ï¼Œä¸€èˆ¬æœ‰<code>for &#123;&#125;</code>ç»“æ„ï¼Œæ— æ³•é€€å‡ºã€‚å½“æˆ‘ä»¬é€€å‡ºä¸»åç¨‹ï¼Œç”±äºç­‰å¾…ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå¡æ­»</p><span id="more"></span><h5 id="1-1-ctx-Done"><a href="#1-1-ctx-Done" class="headerlink" title="1.1 ctx.Done"></a>1.1 ctx.Done</h5><p>æˆ‘ä»¬çš„è¯‰æ±‚æ˜¯åœ¨ä¸»åç¨‹é€€å‡ºæ—¶ï¼Œå­åç¨‹éœ€è¦ä¸€èµ·é€€å‡ºã€‚ä»£ç åšå‡ºå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;os/signal&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;syscall&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithCancel(context.Background())<br><span class="hljs-comment">// ç›‘å¬ç³»ç»Ÿä¸­æ–­ä¿¡å·</span><br>exitCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)<br>signal.Notify(exitCh, syscall.SIGINT, syscall.SIGTERM)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>&lt;-exitCh<br>cancel()<br>&#125;()<br><br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon1(ctx)<br>&#125;(ctx)<br><br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon2(ctx)<br>&#125;(ctx)<br><br>wg.Wait()<br>log.Println(<span class="hljs-string">&quot;main ç»“æŸ...&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon1</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¼€å¯8080ç«¯å£tcpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-comment">// å…³é—­è¿æ¥å’Œlistener</span><br>log.Println(<span class="hljs-string">&quot;daemon1 ç»“æŸ...&quot;</span>)<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br><span class="hljs-comment">// å¤„ç†è¿æ¥</span><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon2</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¼€å¯8080ç«¯å£udpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-comment">// å…³é—­è¿æ¥å’Œlistener</span><br>log.Println(<span class="hljs-string">&quot;daemon2 ç»“æŸ...&quot;</span>)<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br><span class="hljs-comment">// å¤„ç†è¿æ¥</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Tips: åœ¨ä½¿ç”¨<code>context.WithTimeout</code>å’Œ<code>context.withDeadline</code>æ—¶ï¼Œåœ¨è¶…æ—¶åè™½ç„¶<code>ctx.Done</code>ä¼šè§¦å‘ï¼Œä½†æ˜¯è¿™ä¸ªchannelå¹¶ä¸ä¼šå…³é—­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>cancel()</code>å…³é—­è¿™ä¸ª<code>ctx.Done()</code>è¿™ä¸ªchannel</p></blockquote><h4 id="2-æºå¸¦å‚æ•°"><a href="#2-æºå¸¦å‚æ•°" class="headerlink" title="2. æºå¸¦å‚æ•°"></a>2. æºå¸¦å‚æ•°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;os/signal&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;syscall&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithCancel(context.Background())<br><br>ctx = context.WithValue(ctx, <span class="hljs-string">&quot;TCPHandlerName&quot;</span>, <span class="hljs-string">&quot;tcp-daemon&quot;</span>)<br>ctx = context.WithValue(ctx, <span class="hljs-string">&quot;UDPHandlerName&quot;</span>, <span class="hljs-string">&quot;udp-daemon&quot;</span>)<br><br><span class="hljs-comment">// ç›‘å¬ç³»ç»Ÿä¸­æ–­ä¿¡å·</span><br>exitCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)<br>signal.Notify(exitCh, syscall.SIGINT, syscall.SIGTERM)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>&lt;-exitCh<br>cancel()<br>&#125;()<br><br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon1(ctx)<br>&#125;(ctx)<br><br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>daemon2(ctx)<br>&#125;(ctx)<br><br>wg.Wait()<br>log.Println(<span class="hljs-string">&quot;main ç»“æŸ...&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon1</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¼€å¯8080ç«¯å£tcpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-comment">// å…³é—­è¿æ¥å’Œlistener</span><br>log.Println(ctx.Value(<span class="hljs-string">&quot;TCPHandlerName&quot;</span>), <span class="hljs-string">&quot; ç»“æŸ...&quot;</span>)<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br><span class="hljs-comment">// å¤„ç†è¿æ¥</span><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">daemon2</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¼€å¯8080ç«¯å£udpç›‘å¬ï¼Œå¹¶å¤„ç†è¿æ¥</span><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-comment">// å…³é—­è¿æ¥å’Œlistener</span><br>log.Println(ctx.Value(<span class="hljs-string">&quot;UDPHandlerName&quot;</span>), <span class="hljs-string">&quot; ç»“æŸ...&quot;</span>)<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br><span class="hljs-comment">// å¤„ç†è¿æ¥</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Tips: contextçš„valuleåªèƒ½å‘å­ctxä¼ é€’ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œä¸­æ— æ³•ä¼ é€’ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨grpcï¼Œè¯·è€ƒè™‘ä½¿ç”¨metadata</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>db_with_cache</title>
    <link href="/20230523/db-with-cache/"/>
    <url>/20230523/db-with-cache/</url>
    
    <content type="html"><![CDATA[<h3 id="1-DB-å’Œ-Cache-çš„æ•°æ®ä¸€è‡´æ€§"><a href="#1-DB-å’Œ-Cache-çš„æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="1. DB å’Œ Cache çš„æ•°æ®ä¸€è‡´æ€§"></a>1. DB å’Œ Cache çš„æ•°æ®ä¸€è‡´æ€§</h3><ul><li><p><strong>å»¶è¿ŸåŒåˆ </strong></p></li><li><p><strong>binlog å¼‚æ­¥æ›´æ–°</strong></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>common</category>
      
    </categories>
    
    
    <tags>
      
      <tag>common</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>network-interview</title>
    <link href="/20230506/network-interview/"/>
    <url>/20230506/network-interview/</url>
    
    <content type="html"><![CDATA[<h3 id="XSS-æ”»å‡»"><a href="#XSS-æ”»å‡»" class="headerlink" title="XSS æ”»å‡»"></a>XSS æ”»å‡»</h3><h3 id="Grpc-å’Œ-HTTP1-1-åº”ç”¨åœºæ™¯çš„å·®åˆ«"><a href="#Grpc-å’Œ-HTTP1-1-åº”ç”¨åœºæ™¯çš„å·®åˆ«" class="headerlink" title="Grpc å’Œ HTTP1.1 åº”ç”¨åœºæ™¯çš„å·®åˆ«"></a>Grpc å’Œ HTTP1.1 åº”ç”¨åœºæ™¯çš„å·®åˆ«</h3><blockquote><p>gRPC æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„ RPCï¼ˆRemote Procedure Callï¼‰æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Protocol Buffers è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ç‰¹æ€§ï¼Œå¦‚æµå¼å¤„ç†ã€è®¤è¯å’Œæˆæƒç­‰ã€‚åœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹ï¼Œç”±äº gRPC ä½¿ç”¨äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šä¿¡ï¼Œå› æ­¤å®ƒçš„æ•ˆç‡å’Œååé‡éƒ½æ¯” RESTful API æ›´é«˜ã€‚æ­¤å¤–ï¼ŒgRPC è¿˜æä¾›äº†æ›´åŠ ä¸°å¯Œçš„æœåŠ¡å®šä¹‰å’Œä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚<br>è€Œ RESTful API åˆ™æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„ API è®¾è®¡é£æ ¼ï¼Œå®ƒä½¿ç”¨ JSONã€XML ç­‰æ–‡æœ¬æ ¼å¼è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå…·æœ‰ç®€å•ã€çµæ´»ã€æ˜“äºç†è§£å’Œä½¿ç”¨çš„ç‰¹ç‚¹ã€‚RESTful API é€‚ç”¨äºåŸºäº HTTP çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ Web åº”ç”¨ç¨‹åºã€ç§»åŠ¨åº”ç”¨ç¨‹åºç­‰ï¼Œä¸”å¯ä»¥è·¨è¯­è¨€å’Œå¹³å°ä½¿ç”¨ã€‚åœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹ï¼ŒRESTful API å…·æœ‰æ›´åŠ å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æœåŠ¡æš´éœ²ã€API ç½‘å…³ç­‰ã€‚<br>å› æ­¤ï¼Œé€‰æ‹© gRPC è¿˜æ˜¯ RESTful API éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚å’Œåœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚å¦‚æœéœ€è¦é«˜æ€§èƒ½ã€é«˜ååé‡çš„å¾®æœåŠ¡ä¹‹é—´é€šä¿¡ï¼Œæˆ–è€…éœ€è¦æµå¼å¤„ç†ã€è®¤è¯å’Œæˆæƒç­‰é«˜çº§ç‰¹æ€§ï¼Œå¯ä»¥é€‰æ‹© gRPCï¼›å¦‚æœéœ€è¦ç®€å•ã€çµæ´»ã€æ˜“äºç†è§£å’Œä½¿ç”¨çš„ APIï¼Œæˆ–è€…éœ€è¦è·¨è¯­è¨€å’Œå¹³å°ä½¿ç”¨ï¼Œå¯ä»¥é€‰æ‹© RESTful APIã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>interview</tag>
      
      <tag>Network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>string-algorithm</title>
    <link href="/20230506/string-algorithm/"/>
    <url>/20230506/string-algorithm/</url>
    
    <content type="html"><![CDATA[<blockquote><p>waiting to learn</p></blockquote><h3 id="1-å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼ˆKMPï¼‰"><a href="#1-å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼ˆKMPï¼‰" class="headerlink" title="1. å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼ˆKMPï¼‰"></a>1. å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼ˆKMPï¼‰</h3><h3 id="2-LISï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰"><a href="#2-LISï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰" class="headerlink" title="2. LISï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰"></a>2. LISï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰</h3><h3 id="3-LCSï¼ˆæœ€é•¿å…¬å…±å­åºåˆ—ï¼‰"><a href="#3-LCSï¼ˆæœ€é•¿å…¬å…±å­åºåˆ—ï¼‰" class="headerlink" title="3. LCSï¼ˆæœ€é•¿å…¬å…±å­åºåˆ—ï¼‰"></a>3. LCSï¼ˆæœ€é•¿å…¬å…±å­åºåˆ—ï¼‰</h3><h3 id="4-LCPï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰"><a href="#4-LCPï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰" class="headerlink" title="4. LCPï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰"></a>4. LCPï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰</h3><h3 id="5-LPSï¼ˆæœ€é•¿å›æ–‡å­åºåˆ—ï¼‰"><a href="#5-LPSï¼ˆæœ€é•¿å›æ–‡å­åºåˆ—ï¼‰" class="headerlink" title="5. LPSï¼ˆæœ€é•¿å›æ–‡å­åºåˆ—ï¼‰"></a>5. LPSï¼ˆæœ€é•¿å›æ–‡å­åºåˆ—ï¼‰</h3><h3 id="6-EDï¼ˆæœ€å°ç¼–è¾‘è·ç¦»ï¼‰"><a href="#6-EDï¼ˆæœ€å°ç¼–è¾‘è·ç¦»ï¼‰" class="headerlink" title="6. EDï¼ˆæœ€å°ç¼–è¾‘è·ç¦»ï¼‰"></a>6. EDï¼ˆæœ€å°ç¼–è¾‘è·ç¦»ï¼‰</h3>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Algorithm</tag>
      
      <tag>String</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>os-interview</title>
    <link href="/20230506/os-interview/"/>
    <url>/20230506/os-interview/</url>
    
    <content type="html"><![CDATA[<h3 id="1-åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡"><a href="#1-åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡" class="headerlink" title="1. åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡"></a>1. åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡</h3><h3 id="2-çº¿ç¨‹çŠ¶æ€"><a href="#2-çº¿ç¨‹çŠ¶æ€" class="headerlink" title="2. çº¿ç¨‹çŠ¶æ€"></a>2. çº¿ç¨‹çŠ¶æ€</h3><h3 id="3-ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#3-ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="3. ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>3. ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><h3 id="4-æ–‡ä»¶ç³»ç»Ÿæ ¼å¼"><a href="#4-æ–‡ä»¶ç³»ç»Ÿæ ¼å¼" class="headerlink" title="4. æ–‡ä»¶ç³»ç»Ÿæ ¼å¼"></a>4. æ–‡ä»¶ç³»ç»Ÿæ ¼å¼</h3><ol><li>ç±» Unix<br>ext</li></ol><ul><li>ext</li><li>ext2</li><li>ext3</li><li>ext4</li></ul><ol start="2"><li>DOM</li></ol><ul><li>FAT32</li></ul><p>ä¼ ç»Ÿçš„ windows å¹³å°æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œå…¼å®¹æ€§å¼ºã€‚<br>ä½† FAT32 ä¸æ”¯æŒ 4GB ä»¥ä¸Šçš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯æ–­ç”µåå®¹æ˜“å‡ºç°æ–‡ä»¶ä¸¢å¤±çš„æƒ…å†µ</p><ul><li>NTFS</li></ul>]]></content>
    
    
    <categories>
      
      <category>OS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>interview</tag>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql-interview</title>
    <link href="/20230506/sql-interview/"/>
    <url>/20230506/sql-interview/</url>
    
    <content type="html"><![CDATA[<h3 id="1-SQL-è¯­å¥çš„æ‰§è¡Œæµç¨‹"><a href="#1-SQL-è¯­å¥çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="1. SQL è¯­å¥çš„æ‰§è¡Œæµç¨‹"></a>1. SQL è¯­å¥çš„æ‰§è¡Œæµç¨‹</h3><h4 id="1-1-é€»è¾‘å‰–æ"><a href="#1-1-é€»è¾‘å‰–æ" class="headerlink" title="1.1 é€»è¾‘å‰–æ"></a>1.1 é€»è¾‘å‰–æ</h4><blockquote><p>sql è¯­å¥ &gt; æŸ¥è¯¢ç¼“å­˜ &gt; è§£é‡Šå™¨ &gt; ä¼˜åŒ–å™¨ &gt; æ‰§è¡Œå™¨</p></blockquote><h3 id="2-å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºè¡¨æ ¼å¢åŠ å­—æ®µ"><a href="#2-å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºè¡¨æ ¼å¢åŠ å­—æ®µ" class="headerlink" title="2. å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºè¡¨æ ¼å¢åŠ å­—æ®µ"></a>2. å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºè¡¨æ ¼å¢åŠ å­—æ®µ</h3><h3 id="3-äº‹åŠ¡"><a href="#3-äº‹åŠ¡" class="headerlink" title="3.äº‹åŠ¡"></a>3.äº‹åŠ¡</h3><h4 id="3-1-ACID"><a href="#3-1-ACID" class="headerlink" title="3.1 ACID"></a>3.1 ACID</h4><ul><li>Atomicityï¼ŒåŸå­æ“ä½œ</li><li>Consistencyï¼Œä¸€è‡´æ€§</li><li>Isolationï¼Œéš”ç¦»æ€§</li><li>Durabilityï¼ŒæŒä¹…æ€§</li></ul><p>è§£é‡Šå¦‚ä¸‹å¯èƒ½ä¼šç”¨åˆ° 2~3 ä¸ªäº‹åŠ¡ï¼Œè¿™é‡Œç®€ç§° ABCã€‚</p><ul><li><p>è„å†™</p><ol><li>A å…ˆå°†æ•°æ®ä» NULL æ›´æ–°ä¸º 1</li><li>åœ¨ A æœªæäº¤æ—¶ï¼ŒB å°†æ•°æ®ä» 1 æ›´æ–°ä¸º 2</li><li>A åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯å¹¶å›æ»šï¼Œå°†æ•°æ®å›æ»šä¸º NULL</li><li>B æäº¤åå‘ç°æ•°æ®å¹¶ä¸æ˜¯ 2ï¼Œå¹¶ä¸”è‡ªå·±çš„äº‹åŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œå¤±è´¥</li></ol><p>B å†™å¤±è´¥äº†</p></li><li><p>è„è¯»</p><ol><li>A å…ˆå°†æ•°æ®ä» NULL æ›´æ–°ä¸º 1</li><li>åœ¨ A æœªæäº¤æ—¶ï¼ŒB è¯»å–æ•°æ®ä¸º 1</li><li>A åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯å¹¶å›æ»šï¼Œå°†æ•°æ®å›æ»šä¸º NULL</li><li>B å†æ¬¡è¯»å–æ•°æ®å‘ç°æ˜¯ NULL</li></ol><p>B åœ¨ step 2 æ—¶è¯»å–äº†è„æ•°æ®</p></li></ul><blockquote><p>è„å†™å’Œè„è¯»ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹<strong>æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®</strong>è¿›è¡Œæ“ä½œï¼Œåœ¨è¯¥äº‹åŠ¡å‘ç”Ÿé”™è¯¯å›æ»šåï¼Œå°±ä¼šå¯¼è‡´è„å†™å’Œè„è¯»å‘ç”Ÿ</p></blockquote><ul><li><p>ä¸å¯é‡å¤è¯»ï¼ˆupdateï¼‰<br>A åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è¯»å–æ•°æ®ï¼Œä½†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒB å’Œ C ä¿®æ”¹å¹¶æäº¤äº†æ•°æ®ï¼Œå¯¼è‡´ A å¤šæ¬¡è¯»å–è¯»å–åˆ°äº†ä¸åŒçš„å€¼</p></li><li><p>å¹»è¯»ï¼ˆinsert,deleteï¼‰<br>A åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡æŸ¥è¯¢æ•°æ®ï¼Œä½†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒB å’Œ C æ’å…¥å¹¶æäº¤æ–°çš„æ•°æ®ï¼Œå¯¼è‡´ A å¤šæ¬¡æŸ¥è¯¢ï¼ŒæŸ¥åˆ°äº†ä¸åŒæ¡æ•°çš„ç»“æœ</p></li></ul><span id="more"></span><h4 id="3-2-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#3-2-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="3.2 äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>3.2 äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><ul><li><p>Read Uncommittedï¼ˆè¯»æœªæäº¤ï¼‰<br>é¡¾åæ€ä¹‰ï¼Œäº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚ä¼šå‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</p></li><li><p>Read Committedï¼ˆè¯»ä»¥æäº¤ï¼‰<br>äº‹åŠ¡æ— æ³•è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œæœç»è„è¯»å‡ºç°ï¼Œä½†ä»ç„¶ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</p></li><li><p>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰<br>MVCC(Multi-Version Concurrency Control)ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚äº‹åŠ¡å¼€å§‹æ—¶ï¼Œä¼šè¿›è¡Œå¿«ç…§è¯»ï¼Œå¦‚æœæƒ³è¯»å–æ–°çš„æ•°æ®ï¼Œå¯è¿›è¡Œå½“å‰è¯»ã€‚å½“ç„¶è¿™æ ·ä¼šå‡ºç°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„ç°è±¡</p></li><li><p>Serializableï¼ˆåºåˆ—åŒ–ï¼‰<br>äº‹åŠ¡æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œéœ€è¦çš„æ•°æ®è¡Œæˆ–è¡¨éƒ½ä¼šè¢«åŠ é”</p></li></ul><h3 id="4-clickhouse-è¿™ç§åˆ—å¼æ•°æ®åº“å’Œä¼ ç»Ÿæ•°æ®åº“çš„ä¼˜åŠ£"><a href="#4-clickhouse-è¿™ç§åˆ—å¼æ•°æ®åº“å’Œä¼ ç»Ÿæ•°æ®åº“çš„ä¼˜åŠ£" class="headerlink" title="4. clickhouse è¿™ç§åˆ—å¼æ•°æ®åº“å’Œä¼ ç»Ÿæ•°æ®åº“çš„ä¼˜åŠ£"></a>4. clickhouse è¿™ç§åˆ—å¼æ•°æ®åº“å’Œä¼ ç»Ÿæ•°æ®åº“çš„ä¼˜åŠ£</h3><ol><li><p>clickhouse<br>ä¼˜ç‚¹ï¼š</p><ul><li>é«˜æ•ˆæŸ¥è¯¢ï¼šåˆ—å¼æ•°æ®åº“ï¼Œå¯å¿«é€Ÿè¿›è¡ŒèšåˆæŸ¥è¯¢ã€åˆ†æç­‰ï¼Œæœ‰è¾ƒå¼ºçš„å¹¶å‘å¤„ç†èƒ½åŠ›</li><li>å¯æ‰©å±•æ€§ï¼šclickhouse å¯æ°´å¹³æ‰©å±•ï¼Œé€šè¿‡æ·»åŠ æ›´å¤šèŠ‚ç‚¹æ¥æ‰©å±•æ•°æ®åº“çš„å­˜å‚¨å’Œå¤„ç†èƒ½åŠ›</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ•°æ®æ›´æ–°æ“ä½œç›¸å¯¹è¾ƒæ…¢ï¼šä¸é€‚åˆéœ€è¦é¢‘ç¹è¿›è¡Œæ•°æ®æ›´æ–°çš„åœºæ™¯</li><li>ä¸æ”¯æŒå¤æ‚çš„å…³ç³»å‹æ•°æ®åº“æ¨¡å‹ï¼šç”±äºæ˜¯åˆ—å¼æ•°æ®åº“ï¼Œä¸æ”¯æŒä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®æ¨¡å‹</li></ul></li><li><p>mysql ç­‰<br>ä¼˜ç‚¹ï¼š</p><ul><li>äº‹åŠ¡æ”¯æŒï¼šä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æœ‰å¼ºå¤§çš„äº‹åŠ¡æ”¯æŒï¼Œå¯ä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§</li><li>çµæ´»æ€§ï¼šæ”¯æŒå¤æ‚çš„æŸ¥è¯¢å’Œæ•°æ®æ“ä½œï¼Œå¯ä»¥æ»¡è¶³å„ç§ä¸åŒçš„åœºæ™¯</li><li>æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿï¼šä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“æœ‰å¾ˆå¤šæˆç†Ÿçš„å·¥å…·å’Œæ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è¿›è¡Œå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸å¤ªé€‚åˆå¤§æ•°æ®åœºæ™¯ï¼šä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é€šå¸¸ä¸å¤ªé€‚åˆå¤„ç†å¤§æ•°æ®ï¼Œä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆ</li><li>å¯æ‰©å±•æ€§æœ‰é™ï¼šä¼ ç»Ÿæ•°æ®åº“æ‰©å±•æ€§æœ‰ç‚¹ï¼Œéœ€è¦è¿›è¡Œå‚ç›´æ‰©å±•å³ï¼Œå¢åŠ æ›´å¤šçš„è®¡ç®—å’Œå­˜å‚¨èµ„æºï¼Œè¿™ä¼šå¸¦æ¥è¾ƒé«˜çš„æˆæœ¬ã€‚</li></ul></li></ol><h3 id="5-å¼€çª—å‡½æ•°"><a href="#5-å¼€çª—å‡½æ•°" class="headerlink" title="5. å¼€çª—å‡½æ•°"></a>5. å¼€çª—å‡½æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æ’åº</span><br><span class="hljs-built_in">row_number</span>() <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">rank</span>()       <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">dense_rank</span>() <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><br><span class="hljs-comment">-- èšåˆ</span><br><span class="hljs-built_in">count</span>() <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">max</span>()   <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">min</span>()   <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">sum</span>()   <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">avg</span>()   <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><br><span class="hljs-comment">-- å…¶å®ƒ</span><br><span class="hljs-built_in">first_value</span>() <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">last_value</span>()  <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">lag</span>()         <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br><span class="hljs-built_in">lead</span>()        <span class="hljs-keyword">over</span>([<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> ...] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> ...])<br></code></pre></td></tr></table></figure><ol><li>æ’åºå¼€çª—å‡½æ•°</li></ol><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>row_number()</td><td>ç›¸åŒå€¼æ’åé¡ºå»¶ï¼Œç»“æœ<code>1,2,3,4</code></td></tr><tr><td>rank()</td><td>ç›¸åŒå€¼æ’åç›¸åŒï¼Œä½†ä¸é¡ºå»¶ï¼Œç»“æœ<code>1,2,2,4</code></td></tr><tr><td>dense_rank()</td><td>ç›¸åŒå€¼æ’åç›¸åŒï¼Œä½†ç»“æœé¡ºå»¶,ç»“æœ<code>1,2,2,3</code></td></tr><tr><td>ntile(n)</td><td>å°†ç»“æœåˆ†ä¸º n ç»„, ç»“æœ<code>1,1,2,2,...,n,n</code></td></tr></tbody></table><ol start="2"><li>èšåˆå‡½æ•°</li></ol><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>sum()</td><td>åˆ†ç»„æ±‚å’Œ</td></tr><tr><td>count()</td><td>åˆ†ç»„æ±‚æ€»æ•°</td></tr><tr><td>min()</td><td>åˆ†ç»„æ±‚æœ€å°å€¼</td></tr><tr><td>max()</td><td>åˆ†ç»„æ±‚æœ€å¤§å€¼</td></tr><tr><td>avg()</td><td>åˆ†ç»„æ±‚å¹³å‡å€¼</td></tr></tbody></table><ol start="3"><li>å…¶ä»–å‡½æ•°</li></ol><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>lag(column,n,0)</td><td>è¿”å› column å­—æ®µå‘ä¸Šç¬¬ n è¡Œæ•°å€¼ï¼Œè‹¥ä¸å­˜åœ¨é»˜è®¤ä¸ºç¬¬ä¸‰ä¸ªå‚å®¿ï¼Œè‹¥ç¬¬ä¸‰ä¸ªå‚æ•°æ— ï¼Œåˆ™é»˜è®¤ä¸º null</td></tr><tr><td>lead(column,n,0)</td><td>åŒä¸Šï¼Œä½†æ˜¯ä¸ºå‘ä¸‹åç§»</td></tr><tr><td>first_value()</td><td>åˆ†ç»„å†…æ’åºåï¼Œæˆªæ­¢ç›®å‰è¡Œçš„ç¬¬ä¸€ä¸ªå€¼</td></tr><tr><td>last_value()</td><td>åˆ†ç»„å†…æ’åºåï¼Œæˆªæ­¢ç›®å‰è¡Œçš„æœ€åä¸€ä¸ªå€¼</td></tr></tbody></table><h4 id="å¼€çª—å®è·µ"><a href="#å¼€çª—å®è·µ" class="headerlink" title="å¼€çª—å®è·µ"></a>å¼€çª—å®è·µ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">......<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>DB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>interview</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é”</title>
    <link href="/20230504/lock/"/>
    <url>/20230504/lock/</url>
    
    <content type="html"><![CDATA[<h3 id="1-äº’æ–¥é”å’Œè‡ªæ—‹é”"><a href="#1-äº’æ–¥é”å’Œè‡ªæ—‹é”" class="headerlink" title="1. äº’æ–¥é”å’Œè‡ªæ—‹é”"></a>1. äº’æ–¥é”å’Œè‡ªæ—‹é”</h3><p>åŒºåˆ«ï¼š</p><ul><li><p>äº’æ–¥é”ï¼šåœ¨åŠ é”å¤±è´¥åï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾ CPUï¼Œç»™å…¶ä»–çº¿ç¨‹ï¼›<br>äº’æ–¥é”åœ¨åŠ é”å¤±è´¥æ—¶ï¼Œä¼šä»<strong>ç”¨æˆ·æ€é™·å…¥åˆ°å†…æ ¸æ€</strong>ï¼Œè®©å†…æ ¸å¸®æˆ‘ä»¬åˆ‡æ¢çº¿ç¨‹ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚<br>çº¿ç¨‹åœ¨ä¸¤æ¬¡çŠ¶æ€çš„åˆ‡æ¢ä¸­ï¼Œä¼šæœ‰<strong>ä¸¤æ¬¡çº¿ç¨‹<em>ä¸Šä¸‹æ–‡åˆ‡æ¢</em></strong>ã€‚</p><blockquote><p>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ˜¯ä»€ä¹ˆï¼Ÿå½“ä¸¤ä¸ªçº¿ç¨‹æ˜¯å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ã€‚</p></blockquote><ol><li>åŠ é”å¤±è´¥æ—¶ï¼Œå°† CPU è®©ç»™å…¶ä»–çº¿ç¨‹</li><li>é”è¢«é‡Šæ”¾æ—¶ï¼Œçº¿ç¨‹ä¼šè½¬æ¢ä¸º[å°±ç»ª]çŠ¶æ€ï¼Œå†…æ ¸ä¼šåœ¨åˆé€‚æ—¶é—´å°† CPU åˆ‡æ¢å›è¯¥çº¿ç¨‹</li></ol><p>æœ‰å¤§ä½¬ç»Ÿè®¡è¿‡ï¼Œå¤§æ¦‚åœ¨å‡ åçº³ç§’åˆ°å‡ å¾®ç§’ä¹‹é—´ã€‚å¦‚æœä½ èƒ½ç¡®å®šè¢«é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œå°±åº”è¯¥é€‰ç”¨è‡ªæ—‹é”ï¼Œå¦åˆ™ä½¿ç”¨äº’æ–¥é”ã€‚</p></li><li><p>è‡ªæ—‹é”ï¼šåœ¨åŠ é”å¤±è´¥åï¼Œçº¿ç¨‹ä¼šå¿™ç­‰å¾…ï¼Œç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼›<br>è‡ªæ—‹é”æ˜¯é€šè¿‡ CASï¼ˆCompare And Swapï¼‰å‡½æ•°ï¼Œåœ¨ç”¨æˆ·æ€å®ŒæˆåŠ é”å’Œè§£é”ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œç›¸å¯¹äºäº’æ–¥é”æ›´å¿«ï¼Œå¼€é”€æ›´å°ã€‚</p></li></ul><span id="more"></span><h3 id="2-è¯»å†™é”"><a href="#2-è¯»å†™é”" class="headerlink" title="2. è¯»å†™é”"></a>2. è¯»å†™é”</h3><p>è¯»é”æ˜¯äº’æ–¥é”ï¼Œè€Œå†™é”æ˜¯å…±äº«é”ï¼Œå¯ä»¥å¤šä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ï¼Œæ‰€ä»¥è¯»å†™é”åœ¨<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯ä¸­æ›´èƒ½å‘æŒ¥å‡ºä¼˜åŠ¿</p><ul><li>è¯»ä¼˜å…ˆé”<br>åœ¨æœ‰çº¿ç¨‹æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è·å–è¯»é”æ—¶ï¼Œä¼šæŒç»­è·å–è¯»é”ï¼Œå†™é”è¯·æ±‚ç­‰å¾…ï¼›å½“æ‰€æœ‰è¯»é”é‡Šæ”¾æ—¶ï¼Œå†™é”å°†ä¼šè¢«æŒæœ‰ã€‚<blockquote><p>å½“æŒç»­æœ‰çº¿ç¨‹è·å–è¯»é”ï¼Œä¼šå¯¼è‡´å†™çº¿ç¨‹é¥¥é¥¿</p></blockquote></li><li>å†™ä¼˜å…ˆé”<br>åœ¨æœ‰çº¿ç¨‹æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è·å–å†™é”æ—¶ï¼Œä¼šä¼˜å…ˆç­‰å¾…ç°æœ‰çš„è¯»é”é‡Šæ”¾å¹¶è·å–å†™é”ï¼Œå¹¶é˜»å¡åæ¥çš„è¯»é”è¯·æ±‚, ç›´åˆ°å†™é”é‡Šæ”¾ã€‚<blockquote><p>å½“ä¸€ç›´æœ‰çº¿ç¨‹è·å–å†™é”ï¼Œå°±ä¼šå¯¼è‡´è¯»çº¿ç¨‹é¥¥é¥¿</p></blockquote></li><li>å…¬å¹³è¯»å†™é”<br>ç”¨é˜Ÿåˆ—æŠŠè·å–é”çš„çº¿ç¨‹æ’é˜Ÿï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™åŠ é”å³å¯ï¼Œè¿™æ ·è¯»çº¿ç¨‹ä»ç„¶å¯ä»¥å¹¶å‘ï¼Œä¹Ÿä¸ä¼šå‡ºç°é¥¥é¥¿çš„ç°è±¡ã€‚</li></ul><h3 id="3-ä¹è§‚é”"><a href="#3-ä¹è§‚é”" class="headerlink" title="3. ä¹è§‚é”"></a>3. ä¹è§‚é”</h3><p>å…ˆä¿®æ”¹å®Œå…±äº«èµ„æºï¼Œå†éªŒè¯è¿™æ®µæ—¶é—´å†…æœ‰æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ä¿®æ”¹èµ„æºï¼Œé‚£ä¹ˆæ“ä½œå®Œæˆï¼Œå¦‚æœå‘ç°æœ‰å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹è¿‡è¿™ä¸ªèµ„æºï¼Œå°±æ”¾å¼ƒæœ¬æ¬¡æ“ä½œã€‚<br>ä¹è§‚é”è™½ç„¶å»é™¤äº†åŠ é”è§£é”çš„æ“ä½œï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†²çªï¼Œé‡è¯•çš„æˆæœ¬éå¸¸é«˜ï¼Œæ‰€ä»¥åªæœ‰åœ¨<strong>å†²çªæ¦‚ç‡éå¸¸ä½</strong>ï¼Œä¸”<strong>åŠ é”æˆæœ¬éå¸¸é«˜</strong>çš„åœºæ™¯æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ä¹è§‚é”ã€‚</p><h3 id="4-åˆ†å¸ƒå¼é”-å¤šä¸ªæœåŠ¡ç«äº‰åŒä¸ªèµ„æº"><a href="#4-åˆ†å¸ƒå¼é”-å¤šä¸ªæœåŠ¡ç«äº‰åŒä¸ªèµ„æº" class="headerlink" title="4. åˆ†å¸ƒå¼é”(å¤šä¸ªæœåŠ¡ç«äº‰åŒä¸ªèµ„æº)"></a>4. åˆ†å¸ƒå¼é”(å¤šä¸ªæœåŠ¡ç«äº‰åŒä¸ªèµ„æº)</h3><ul><li><p>setnx or (set )</p><ol><li>åŠ é”</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨setnx</span><br>setnx lock_name uid<br>expire lock_name ttl<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨<span class="hljs-built_in">set</span> + nx</span><br>set lock_name uid ex ttl nx<br></code></pre></td></tr></table></figure><blockquote><p>ttl ç”Ÿå‘½å‘¨æœŸ(æ¯«ç§’)</p></blockquote><p>ä½¿ç”¨<code>setnx</code>è¿›è¡Œäº†ä¸¤æ­¥æ“ä½œï¼ŒéåŸå­æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨<code>set</code> + <code>nx</code>ã€‚</p><ol start="2"><li>è§£é”</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">&quot;get&quot;</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span><br>  <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">&quot;del&quot;</span>, KEYS[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">else</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>è§£é”æ—¶ä¸ºé¿å…éæœ¬äººè§£é”ï¼Œä¸€èˆ¬å°†æœåŠ¡çš„ uid (unique id) å­˜å‚¨åœ¨é”çš„ value ä¸­ï¼Œè§£é”æ˜¯å¯¹æ¯” value,é˜²æ­¢é”™è¯¯è§£é”å¼•å‘äº‹æ•…ã€‚<br>ä¸ºä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨ lua è„šæœ¬è¿›è¡Œæ“ä½œã€‚</p></li><li><p>é€šè¿‡ sql ä¸­çš„ unique ç´¢å¼•</p><ol><li>å‘è¡¨ä¸­çš„å”¯ä¸€ç´¢å¼•åˆ—æ’å…¥ lock_nameï¼ŒæˆåŠŸåˆ™è·å¾—é”æˆåŠŸï¼Œåä¹‹å¤±è´¥</li><li>é€šè¿‡ delete è¯­å¥åˆ é™¤ lock_name</li></ol></li><li><p>redisson ç­‰ç­‰</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>OS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Locker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goå†…å­˜å¯¹é½çš„ä¸€äº›é—®é¢˜</title>
    <link href="/20230418/golang-memory-align-use64in32/"/>
    <url>/20230418/golang-memory-align-use64in32/</url>
    
    <content type="html"><![CDATA[<h3 id="1-atomic-AddInt64åœ¨-32-ä½æ“ä½œç³»ç»Ÿä¸Šå†…å­˜å¯¹é½çš„é—®é¢˜"><a href="#1-atomic-AddInt64åœ¨-32-ä½æ“ä½œç³»ç»Ÿä¸Šå†…å­˜å¯¹é½çš„é—®é¢˜" class="headerlink" title="1. atomic.AddInt64åœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸Šå†…å­˜å¯¹é½çš„é—®é¢˜"></a>1. <code>atomic.AddInt64</code>åœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸Šå†…å­˜å¯¹é½çš„é—®é¢˜</h3><h4 id="1-1-é—®é¢˜"><a href="#1-1-é—®é¢˜" class="headerlink" title="1.1 é—®é¢˜"></a>1.1 é—®é¢˜</h4><p>åœ¨32ä½æœºå™¨ä¸Šä½¿ç”¨int64å¯èƒ½ä¼šå‡ºç°<code>panic: unaligned 64-bit atomic operation</code></p><h4 id="1-2-è§¦å‘ä»£ç "><a href="#1-2-è§¦å‘ä»£ç " class="headerlink" title="1.2 è§¦å‘ä»£ç "></a>1.2 è§¦å‘ä»£ç </h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;sync/atomic&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Foo <span class="hljs-keyword">struct</span> &#123;<br>a <span class="hljs-type">int64</span><br>b <span class="hljs-type">int32</span><br>c <span class="hljs-type">int64</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> f Foo<br>atomic.AddInt64(&amp;f.a, <span class="hljs-number">1</span>) <span class="hljs-comment">// è¿™é‡Œä¸ä¼šå´©æºƒ</span><br>atomic.AddInt64(&amp;f.c, <span class="hljs-number">1</span>) <span class="hljs-comment">// è¿™é‡Œä¼šå´©æºƒ</span><br>&#125;<br></code></pre></td></tr></table></figure><span id="more"></span><h4 id="2-æº¯æº"><a href="#2-æº¯æº" class="headerlink" title="2. æº¯æº"></a>2. æº¯æº</h4><p>å…ˆçœ‹æºç ã€‚æºç æ˜¯æ±‡ç¼–å†™çš„ï¼Œåœ¨<code>runtime/internal/atomic/atomic_&lt;ç³»ç»Ÿæ¶æ„&gt;.s</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯ arm æ¶æ„ï¼Œæ‰€ä»¥æºç ä¹Ÿæ˜¯<code>atomic_arm.s</code>ä¸­çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs unix-assembly">TEXT Â·Xadd64(SB),NOSPLIT,$-4-20<br>NO_LOCAL_POINTERS<br>MOVWaddr+0(FP), R1<br>CHECK_ALIGN<br><br>MOVBruntimeÂ·goarm(SB), R11<br>CMP$7, R11<br>BLT2(PC)<br>JMParmXadd64&lt;&gt;(SB)<br>JMPÂ·goXadd64(SB)<br><br>TEXT armXadd64&lt;&gt;(SB),NOSPLIT,$0-20<br>// addr is already in R1<br>MOVWdelta_lo+4(FP), R2<br>MOVWdelta_hi+8(FP), R3<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//go:nosplit</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">goXadd64</span><span class="hljs-params">(addr *<span class="hljs-type">uint64</span>, delta <span class="hljs-type">int64</span>)</span></span> <span class="hljs-type">uint64</span> &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-type">uintptr</span>(unsafe.Pointer(addr))&amp;<span class="hljs-number">7</span> != <span class="hljs-number">0</span> &#123;<br>*(*<span class="hljs-type">int</span>)(<span class="hljs-literal">nil</span>) = <span class="hljs-number">0</span> <span class="hljs-comment">// crash on unaligned uint64</span><br>&#125;<br>_ = *addr <span class="hljs-comment">// if nil, fault before taking the lock</span><br><span class="hljs-keyword">var</span> r <span class="hljs-type">uint64</span><br>addrLock(addr).lock()<br>r = *addr + <span class="hljs-type">uint64</span>(delta)<br>*addr = r<br>addrLock(addr).unlock()<br><span class="hljs-keyword">return</span> r<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»€ä¹ˆï¼Ÿæ±‡ç¼–çœ‹ä¸æ‡‚å—ï¼Ÿå…¶å®æˆ‘ä¹Ÿçœ‹ä¸æ‡‚â€¦,é—®é—® gpt å§<br><img src="/images/2023-04-18_09-48-06.jpg"></p><p>æ±‡ç¼–åœ¨è°ƒç”¨æ—¶åšäº†<code>CHECK_ALIGN</code>(å†…å­˜å¯¹é½çš„æ£€æŸ¥)<br><img src="/images/2023-04-18_10-55-37.jpg"></p><p>åœ¨å†…å­˜æœªå¯¹é½æ—¶ï¼Œä¼šç›´æ¥äº§ç”Ÿ panic è¿›è€Œä¸­æ–­ç¨‹åºï¼ŒåŒ…æ‹¬åœ¨<code>goXadd64</code>ä¸­ä¹Ÿè¿›è¡Œäº†åˆ¤æ–­<code>*(*int)(nil) = 0 // crash on unaligned uint64</code></p><p>å‚è€ƒï¼š<a href="https://pengrl.com/p/21030/">yoko blog | 32ä½ç³»ç»Ÿä¸‹ï¼ŒGoæ ‡å‡†åº“ä¸­atomicåŸå­æ“ä½œint64æœ‰å´©æºƒbug</a></p>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Memory Align</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Etcd</title>
    <link href="/20230416/etcd-intro-md/"/>
    <url>/20230416/etcd-intro-md/</url>
    
    <content type="html"><![CDATA[<h3 id="1-etcd-æ˜¯ä»€ä¹ˆ"><a href="#1-etcd-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1. etcd æ˜¯ä»€ä¹ˆ"></a>1. etcd æ˜¯ä»€ä¹ˆ</h3><p>etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å¯¹å­˜å‚¨ï¼Œè®¾è®¡ç”¨æ¥å¯é è€Œå¿«é€Ÿçš„ä¿å­˜å…³é”®æ•°æ®å¹¶æä¾›è®¿é—®ã€‚<br>é€šè¿‡åˆ†å¸ƒå¼é”ï¼Œleader é€‰ä¸¾å’Œå†™å±éšœ(write barriers)æ¥å®ç°å¯é çš„åˆ†å¸ƒå¼åä½œã€‚<br>etcd é›†ç¾¤æ˜¯ä¸ºé«˜å¯ç”¨ï¼ŒæŒä¹…æ€§æ•°æ®å­˜å‚¨å’Œæ£€ç´¢è€Œå‡†å¤‡ã€‚</p><h4 id="1-1-etcd-çš„åº”ç”¨åœºæ™¯"><a href="#1-1-etcd-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="1.1 etcd çš„åº”ç”¨åœºæ™¯:"></a>1.1 etcd çš„åº”ç”¨åœºæ™¯:</h4><ul><li>æœåŠ¡å‘ç°</li><li>æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…</li><li>è´Ÿè½½å‡è¡¡</li><li>åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é˜Ÿåˆ—</li><li>é›†ç¾¤ç›‘æ§å’Œ leader ç«é€‰</li></ul><h3 id="2-etcd-çš„åŸºæœ¬æ“ä½œ"><a href="#2-etcd-çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="2. etcd çš„åŸºæœ¬æ“ä½œ"></a>2. etcd çš„åŸºæœ¬æ“ä½œ</h3><ul><li>é€šè¿‡ http è¿›è¡Œé€šä¿¡</li><li>é€šè¿‡ etcdctl è¿æ¥è¿›è¡Œæ“ä½œ</li></ul><span id="more"></span><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">putæŒ‡ä»¤(update or create <span class="hljs-keyword">if</span> key not exist)</span><br>etcdctl put [key] [value]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">getæŒ‡ä»¤(search key-value)</span><br>etcdctl get [key]<br>etcdctl get [key1] [key2] [key3] [â€¦]<br>etcdctl get [ke] --prefix<br>etcdctl get [key] -w json # ä½¿ç”¨jsonæ ¼å¼è¾“å‡º<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">delæŒ‡ä»¤(delete key-value)</span><br>etcdctl del [key1] [â€¦]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">watchæŒ‡ä»¤(Monitor the operation of the target key)</span><br>etcdctl watch [key]             # ç›‘æ§å•ä¸ªkey<br>etcdctl watch [key] --prefix    # ç›‘æ§ä¸€ç±»å‰ç¼€çš„key<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">txnæŒ‡ä»¤(äº‹åŠ¡)</span><br>etcdctl txn -i<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">leaseæŒ‡ä»¤(ç§Ÿçº¦ï¼Œå³keyçš„TTLç”Ÿå­˜æ—¶é—´)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">etcdéœ€è¦å…ˆåˆ›å»ºç§Ÿçº¦æ‰èƒ½é€šè¿‡`etcdctl put --lease=&lt;lease_id&gt; [key] [value]`æ¥è®¾ç½®key-valueçš„TTL</span><br><br>etcdctl lease grant 30          # åˆ›å»ºä¸€ä¸ªTTL=30sçš„ç§Ÿçº¦<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">lease &lt;lease_id&gt; granted with TTL(30s)</span><br>etcdctl put --lease=&lt;lease_id&gt; [key] [value]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">leaseä¹Ÿä¼šéšç€TTLæ—¶é—´è¿‡å»è€Œåˆ°æœŸ</span><br></code></pre></td></tr></table></figure><h3 id="3-etcd-çš„é›†ç¾¤ä¸€è‡´æ€§"><a href="#3-etcd-çš„é›†ç¾¤ä¸€è‡´æ€§" class="headerlink" title="3. etcd çš„é›†ç¾¤ä¸€è‡´æ€§"></a>3. etcd çš„é›†ç¾¤ä¸€è‡´æ€§</h3><p>etcd ä½¿ç”¨ Raft åè®®ï¼Œå®ç°å¼ºä¸€è‡´æ€§</p><h4 id="3-1-Raft-åè®®æ¶æ„"><a href="#3-1-Raft-åè®®æ¶æ„" class="headerlink" title="3.1 Raft åè®®æ¶æ„"></a>3.1 Raft åè®®æ¶æ„</h4><p>raft åè®®ä¸­ï¼ŒèŠ‚ç‚¹æœ‰ä¸‰ç§è§’è‰²ï¼šleaderã€followerã€candidateã€‚<br>åˆå§‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸º followerï¼Œå½“ follower èŠ‚ç‚¹åœ¨æŒ‡å®šæ—¶å¸¸å†…æ²¡æ”¶åˆ° leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šæ™‹å‡ä¸º candidate(å€™é€‰èŠ‚ç‚¹)ï¼Œ<br>å€™é€‰èŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€æŠ•ç¥¨è¯·æ±‚ï¼Œè¯·æ±‚å…¶ä»–èŠ‚ç‚¹æŠ•ç¥¨ï¼Œç¥¨æ•°è¶…è¿‡é›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸€åŠçš„èŠ‚ç‚¹ä¼šæ™‹å‡ä¸º leaderã€‚leader è´Ÿè´£å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚ã€‚<br>è‹¥äº‹åŠ¡è¯·æ±‚æ²¡åˆ° leaderï¼Œfollower èŠ‚ç‚¹ä¹Ÿä¼šå°†è¯·æ±‚è½¬å‘ç»™ leaderã€‚</p><h4 id="3-2-Raft-åè®®ä¸€è‡´æ€§"><a href="#3-2-Raft-åè®®ä¸€è‡´æ€§" class="headerlink" title="3.2 Raft åè®®ä¸€è‡´æ€§"></a>3.2 Raft åè®®ä¸€è‡´æ€§</h4><p>å½“ leader èŠ‚ç‚¹æ¥æ”¶åˆ°äº‹åŠ¡è¯·æ±‚åï¼Œä¼šå…ˆå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œç„¶åå‘é›†ç¾¤ä¸­æ¯ä¸ª follower èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ›´æ–°æ•°æ®ã€‚<br>è‹¥è¶…è¿‡ä¸€åŠèŠ‚ç‚¹éƒ½è®¤åŒæ­¤æ¬¡æ“ä½œï¼Œåˆ™ leader èŠ‚ç‚¹ä¼šå°†æ•°æ®æ›´æ–°ï¼Œå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶é€šçŸ¥æ¯ä¸ª follower èŠ‚ç‚¹ï¼Œæ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚ä»è€Œä¿è¯é›†ç¾¤æ•°æ®çš„ä¸€è‡´æ€§</p>]]></content>
    
    
    <categories>
      
      <category>NoSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Etcd</tag>
      
      <tag>Service Discovery</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis</title>
    <link href="/20230416/redis-intro-md/"/>
    <url>/20230416/redis-intro-md/</url>
    
    <content type="html"><![CDATA[<h3 id="1-redis-ç®€ä»‹"><a href="#1-redis-ç®€ä»‹" class="headerlink" title="1. redis ç®€ä»‹"></a>1. redis ç®€ä»‹</h3><p>redis æ˜¯å†…å­˜å‹ NoSQL æ•°æ®åº“ï¼Œå› å…¶ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œæ€§èƒ½ä¼˜è¶Šï¼Œå…¶è¯»å†™é€Ÿåº¦è¿œè¶…å…¶ä»–ç±»å‹çš„æ•°æ®åº“ã€‚</p><h4 id="1-1-redis-çš„åº”ç”¨åœºæ™¯"><a href="#1-1-redis-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="1.1 redis çš„åº”ç”¨åœºæ™¯"></a>1.1 redis çš„åº”ç”¨åœºæ™¯</h4><ul><li>ç¼“å­˜ï¼šä½¿ç”¨ redis å­˜å‚¨ä¸€äº›å¸¸ç”¨çš„ä¸»è¦æ•°æ®å¯ä»¥æå‡å“åº”é€Ÿåº¦ï¼ˆredis å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼‰</li><li>é«˜é€Ÿè¯»å†™åœºåˆï¼šåœ¨é«˜é¢‘æ¬¡è¯»å†™æ“ä½œæ—¶ï¼Œæ•°æ®åº“çš„å“åº”å°±ä¼šæ˜¾è‘—é™ä½ã€‚è€Œè¿™æ—¶ï¼Œä½¿ç”¨ redis è¿›è¡Œé«˜é€Ÿè¯»å†™ï¼Œåœ¨è¯»å†™ç»“æŸæ—¶ï¼Œå¼‚æ­¥å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­</li></ul><h3 id="2-redis-çš„æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ“ä½œ"><a href="#2-redis-çš„æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ“ä½œ" class="headerlink" title="2.redis çš„æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ“ä½œ"></a>2.redis çš„æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ“ä½œ</h3><h4 id="2-1-redis-çš„æ•°æ®ç±»å‹"><a href="#2-1-redis-çš„æ•°æ®ç±»å‹" class="headerlink" title="2.1 redis çš„æ•°æ®ç±»å‹"></a>2.1 redis çš„æ•°æ®ç±»å‹</h4><ul><li>String(äºŒè¿›åˆ¶å®‰å…¨ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œä¾‹å¦‚ jpg æˆ–å…¶ä»–åºåˆ—åŒ–å­—èŠ‚ï¼Œæœ€å¤§å­˜å‚¨ 512MB)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">update or (create <span class="hljs-keyword">if</span> not exist)</span><br>set [key] [value]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">search key</span><br>get [key]<br></code></pre></td></tr></table></figure><ul><li>Hash</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">update or (create <span class="hljs-keyword">if</span> not exist) field</span><br>hset [key] [field1] [value1] [â€¦] [â€¦]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">search field of hset key</span><br>hget [key] [field1]<br></code></pre></td></tr></table></figure><span id="more"></span><ul><li>List(æŒ‰ç…§æ’å…¥é¡ºåºæ’åº)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">é˜Ÿåˆ—</span><br>lpush [key] [value1]<br>lpush [key] [value2]<br><br>rpop [key]<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">value1</span><br>rpop [key]<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">value2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">-------</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ ˆ</span><br>lpush [key] [value1]<br>lpush [key] [value2]<br><br>lpop [key]<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">value2</span><br>lpop [key]<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">value1</span><br><br></code></pre></td></tr></table></figure><ul><li>Set(String çš„æ— åºé›†åˆ)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">add</span><br>sadd [key] [member1]<br>sadd [key] [member2]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹<span class="hljs-built_in">set</span>ä¸­æ‰€æœ‰å…ƒç´ </span><br>smembers [key]<br><br></code></pre></td></tr></table></figure><ul><li>Zset(æœ‰åºé›†åˆï¼Œé€šè¿‡å…³è”åˆ†æ•°ä»è€Œæœ‰åº)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">zadd [key] [score] [member1]<br>zadd [key] [score] [member2]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹zsetä¸­åˆ†ä¸ºåœ¨[minScore, maxScore]ä¸­çš„å…ƒç´ </span><br>zrangebyscore [key] [minScore] [maxScore]<br></code></pre></td></tr></table></figure><h4 id="2-2-å‘å¸ƒè®¢é˜…-æ¶ˆæ¯é€šä¿¡æ¨¡å¼"><a href="#2-2-å‘å¸ƒè®¢é˜…-æ¶ˆæ¯é€šä¿¡æ¨¡å¼" class="headerlink" title="2.2 å‘å¸ƒè®¢é˜…(æ¶ˆæ¯é€šä¿¡æ¨¡å¼)"></a>2.2 å‘å¸ƒè®¢é˜…(æ¶ˆæ¯é€šä¿¡æ¨¡å¼)</h4><ol><li>ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯é€šè¿‡<code>subscribe [channel_key]</code>è®¢é˜…é¢‘é“</li><li>æœåŠ¡ç«¯é€šè¿‡<code>publish [channel_key] [msg]</code>å‘å¸ƒæ¶ˆæ¯ï¼Œæ¯ä¸ªè®¢é˜…çš„å®¢æˆ·ç«¯éƒ½ä¼šå—åˆ°æ¶ˆæ¯</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">client1</span><br>subscribe msg_channel<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">client2</span><br>subscribe msg_channel<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">server</span><br>publish msg_channel &quot;hello world&quot;<br><br></code></pre></td></tr></table></figure><h4 id="2-3-äº‹åŠ¡"><a href="#2-3-äº‹åŠ¡" class="headerlink" title="2.3 äº‹åŠ¡"></a>2.3 äº‹åŠ¡</h4><p>å’Œæ•°æ®åº“ä¸šåŠ¡ä¸åŒï¼Œredis äº‹åŠ¡éåŸå­æ€§ï¼Œä¸”äº‹åŠ¡ä¸­æŸä¸ªæ“ä½œå¤±è´¥ï¼Œä¸ä¼šå›æ»šï¼Œä¹Ÿä¸ä¼šåœæ­¢äº‹åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¼€å¯äº‹åŠ¡</span><br>multi<br><br>[cmd â€¦]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç›‘è§†keys, åœ¨äº‹åŠ¡æ‰§è¡Œå‰ï¼Œæœ‰è¢«ç›‘è§†çš„keyè¢«æ”¹åŠ¨ï¼Œåˆ™äº‹åŠ¡å°†ä¼šè¢«æ‰“æ–­(`unwatch [key] [â€¦]`å–æ¶ˆç›‘è§†)</span><br>watch [key] [â€¦]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰§è¡Œäº‹åŠ¡</span><br>exec<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å–æ¶ˆäº‹åŠ¡</span><br>discard<br></code></pre></td></tr></table></figure><h4 id="2-4-æ•°æ®å¤‡ä»½å’Œæ¢å¤"><a href="#2-4-æ•°æ®å¤‡ä»½å’Œæ¢å¤" class="headerlink" title="2.4 æ•°æ®å¤‡ä»½å’Œæ¢å¤"></a>2.4 æ•°æ®å¤‡ä»½å’Œæ¢å¤</h4><p>â€¦â€¦</p><h4 id="2-5-Redis-ç®¡é“"><a href="#2-5-Redis-ç®¡é“" class="headerlink" title="2.5 Redis ç®¡é“"></a>2.5 Redis ç®¡é“</h4><p>â€¦â€¦</p><h3 id="3-Reids-æ·˜æ±°ç­–ç•¥"><a href="#3-Reids-æ·˜æ±°ç­–ç•¥" class="headerlink" title="3. Reids æ·˜æ±°ç­–ç•¥"></a>3. Reids æ·˜æ±°ç­–ç•¥</h3><p>å½“å†…å­˜è¶…å‡ºç‰©ç†å†…å­˜é™åˆ¶ï¼Œå°±ä¼šä½¿ç”¨ swap æˆ–è™šæ‹Ÿå†…å­˜ï¼Œè¿™éƒ½æ˜¯å’Œç£ç›˜è¿›è¡Œäº¤æ¢ï¼Œä¼šå¯¼è‡´ redis çš„æ€§èƒ½å¤§æ‰“æŠ˜æ‰£ã€‚<br>æ‰€ä»¥ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéƒ½ä¼šè®¾ç½®<code>maxmemory</code>å‚æ•°é™åˆ¶ redis æœ€å¤§å ç”¨ã€‚å½“ redis å†…å­˜å ç”¨è¶…è¿‡<code>maxmemory</code>åï¼Œæ–°çš„æ•°æ®æ— æ³•å†™å…¥ï¼Œ<br>redis æä¾›äº†å‡ ç§æ·˜æ±°ç­–ç•¥ï¼Œæ¸…ç†æ•°æ®ç”¨äºå­˜æ”¾æ–°çš„æ•°æ®ã€‚</p><ul><li>noeviction(default): ä¸å¯å†™å…¥æ–°çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šä¸¢å¼ƒæ•°æ®</li><li>volatile-lru: æ·˜æ±°å…·æœ‰è¿‡æœŸæ—¶é—´ä¸”æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key</li><li>allkeys-lru: æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key</li><li>volatile-ttl: æ·˜æ±°å…·æœ‰è¿‡æœŸæ—¶é—´ä¸” ttl æœ€å°çš„ key</li><li>volatile-random: éšæœºæ·˜æ±°å…·æœ‰è¿‡æœŸæ—¶é—´çš„ key</li><li>allkeys-random: éšæœºæ·˜æ±° key</li></ul><h4 id="3-1-è¿‘ä¼¼-LRU-ç®—æ³•"><a href="#3-1-è¿‘ä¼¼-LRU-ç®—æ³•" class="headerlink" title="3.1 è¿‘ä¼¼ LRU ç®—æ³•"></a>3.1 è¿‘ä¼¼ LRU ç®—æ³•</h4><p>Redis ä½¿ç”¨è¿‘ä¼¼ LRU ç®—æ³•ï¼Œå› ä¸º LRU ç®—æ³•è¿˜éœ€è¦ä¸€ä¸ªé“¾è¡¨æŒ‰ç…§è®¿é—®æ—¶é—´é¡ºåºä¿å­˜èŠ‚ç‚¹ï¼Œè¿™å°†å ç”¨å¤§é‡çš„é¢å¤–å†…å­˜ï¼Œ<br>è¿‘ä¼¼ LRU ç®—æ³•æ˜¯ Redis åœ¨ç°æœ‰çš„æ•°æ®ç»“æ„åŸºç¡€ä¸Šä½¿ç”¨éšæœºé‡‡æ ·æ³•æ¥æ·˜æ±°å…ƒç´ ï¼Œå¯ä»¥è¾¾åˆ°ä¸ LRU ç®—æ³•éå¸¸è¿‘ä¼¼çš„æ•ˆæœï¼ŒRedis ç»™æ¯ä¸ª key å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„å°å­—æ®µï¼Œé•¿åº¦ä¸º 24 ä¸ª bitï¼Œç”¨äºä¿å­˜æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´æˆ³ã€‚</p><h4 id="3-2-éšæœºé‡‡æ ·"><a href="#3-2-éšæœºé‡‡æ ·" class="headerlink" title="3.2 éšæœºé‡‡æ ·"></a>3.2 éšæœºé‡‡æ ·</h4><p>è¿‘ä¼¼ LRU ç®—æ³•è§¦å‘æ˜¯åœ¨ Redis æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå‘ç°å†…å­˜è¶…å‡º maxmemory çš„å€¼äº†ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡è¯¥ç®—æ³•ï¼Œé€šè¿‡éšæœºé‡‡æ ·å‡º maxmemory_samples (é»˜è®¤å€¼ä¸º 5) ä¸ª keyï¼Œç„¶åæ·˜æ±°æ‰æœ€æ—§çš„ä¸€ä¸ª keyï¼Œå¦‚æœæ·˜æ±°åå†…å­˜è¿˜æ˜¯è¶…å‡º maxmemoryï¼Œé‚£å°±ç»§ç»­éšæœºé‡‡æ ·æ·˜æ±°ï¼Œç›´åˆ°ä½äº maxmemoryã€‚<br>é‡‡æ ·çš„æ•°æ®æ ¹æ® maxmemory-policy çš„è®¾ç½®å†³å®šï¼Œå¦‚æœæ˜¯ allkeysï¼Œåœ¨æ‰€æœ‰çš„å­—å…¸ key ä¸­è¿›è¡Œé‡‡æ ·ï¼Œå¦‚æœæ˜¯ volatileï¼Œåˆ™åœ¨å…·æœ‰è¿‡æœŸæ—¶é—´ key çš„å­—å…¸ä¸­é‡‡æ ·ï¼Œé‡‡æ ·çš„æ•°é‡æ ¹æ® maxmemory_samples é…ç½®å¾—æ¥ï¼Œé‡‡æ ·æ•°é‡è¶Šå¤§ï¼Œè¿‘ä¼¼ LRU ç®—æ³•çš„æ•ˆæœè¶Šæ¥è¿‘ä¸¥æ ¼ LRU ç®—æ³•ï¼Œ<br>åŒæ—¶åœ¨ Redis3.0 ä¸­ï¼Œè¿˜å¢åŠ äº†ä¸€ä¸ªæ·˜æ±°æ± æ•°ç»„ï¼Œå¤§å°æ˜¯ maxmemory_samplesï¼Œåœ¨æ¯ä¸€æ¬¡æ·˜æ±°å¾ªç¯ä¸­ï¼Œæ–°çš„é‡‡æ ·å‡ºæ¥çš„ key ä¼šå’Œæ·˜æ±°æ± ä¸­çš„ key è¿›è¡Œèåˆï¼Œæ·˜æ±°æ‰æœ€æ—§çš„ä¸€ä¸ª keyï¼Œç„¶åå°†å‰©ä½™æœ€æ—§çš„ key åˆ—è¡¨æ”¾å…¥æ·˜æ±°æ± ï¼Œç­‰å¾…ä¸‹æ¬¡å¾ªç¯ã€‚</p><h3 id="4-Redis-é›†ç¾¤"><a href="#4-Redis-é›†ç¾¤" class="headerlink" title="4. Redis é›†ç¾¤"></a>4. Redis é›†ç¾¤</h3><ul><li><p>ä¸»ä»å¤åˆ¶</p></li><li><p>sentinel æ¨¡å¼(å“¨å…µ)</p></li><li><p>cluster æ¨¡å¼</p></li></ul><h3 id="5-Redis-ç‰¹æ®Šæ•°æ®ç»“æ„çš„åº•å±‚å®ç°"><a href="#5-Redis-ç‰¹æ®Šæ•°æ®ç»“æ„çš„åº•å±‚å®ç°" class="headerlink" title="5. Redis ç‰¹æ®Šæ•°æ®ç»“æ„çš„åº•å±‚å®ç°"></a>5. Redis ç‰¹æ®Šæ•°æ®ç»“æ„çš„åº•å±‚å®ç°</h3><h4 id="5-1-Set"><a href="#5-1-Set" class="headerlink" title="5.1 Set"></a>5.1 Set</h4><ul><li><p>intset</p></li><li><p>hashtable<br>ä½¿ç”¨ hash ä¸­ key çš„å”¯ä¸€æ€§æ¥ç¡®å®š set ä¸­å€¼ä¸ä¼šé‡å¤</p></li></ul><h4 id="5-2-ZSet"><a href="#5-2-ZSet" class="headerlink" title="5.2 ZSet"></a>5.2 ZSet</h4><blockquote><p>å½“æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä½¿ç”¨ ziplistï¼Œåä¹‹åˆ™ä½¿ç”¨ skiplist</p><ul><li>zset å…ƒç´ æ•°é‡å°‘äº 128</li><li>zset çš„æ‰€æœ‰å…ƒç´ å­—é•¿éƒ½&lt;&#x3D; 64 å­—èŠ‚</li></ul></blockquote><ul><li><p>ziplist</p></li><li><p>skiplist</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>NoSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>KeyValueDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goçš„cpuè°ƒåº¦</title>
    <link href="/20230410/golang-cpu-schedula/"/>
    <url>/20230410/golang-cpu-schedula/</url>
    
    <content type="html"><![CDATA[<h3 id="1-è°ƒåº¦æ¨¡å‹-GPM"><a href="#1-è°ƒåº¦æ¨¡å‹-GPM" class="headerlink" title="1. è°ƒåº¦æ¨¡å‹ GPM"></a>1. è°ƒåº¦æ¨¡å‹ GPM</h3>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goé¢è¯•é—®é¢˜</title>
    <link href="/20230410/golang-interview/"/>
    <url>/20230410/golang-interview/</url>
    
    <content type="html"><![CDATA[<h3 id="1-Slice-æ‰©å®¹æœºåˆ¶"><a href="#1-Slice-æ‰©å®¹æœºåˆ¶" class="headerlink" title="1. Slice æ‰©å®¹æœºåˆ¶"></a>1. Slice æ‰©å®¹æœºåˆ¶</h3><ul><li><p>å½“ newLen &gt;&#x3D; 2 * cap, åˆ™ newCap &#x3D; newLen</p></li><li><p>å½“ newLen &lt; 2 * cap</p><ul><li>å¦‚æœ cap &lt; 256, åˆ™ newCap &#x3D; 2 * cap</li><li>å¦‚æœ cap &gt;&#x3D; 256, åˆ™ newCap &#x3D; cap + (cap + 3 * threshold) &#x2F; 4, å³ 1.25 å€å®¹é‡+ 0.75 å€é˜ˆå€¼çš„å¹³æ»‘å› å­, å¹³æ»‘å› å­åœ¨å„ä¸ªé˜ˆå€¼é˜¶æ®µä¹Ÿä¼šä¸åŒ<table><thead><tr><th align="center">starting cap</th><th align="center">growth factor</th></tr></thead><tbody><tr><td align="center">256</td><td align="center">2.0</td></tr><tr><td align="center">512</td><td align="center">1.63</td></tr><tr><td align="center">1024</td><td align="center">1.44</td></tr><tr><td align="center">2048</td><td align="center">1.35</td></tr><tr><td align="center">4096</td><td align="center">1.30</td></tr></tbody></table></li></ul></li></ul><span id="more"></span><h3 id="2-ç»“æ„ä½“æ‰€å å­—èŠ‚é•¿åº¦æ€ä¹ˆè®¡ç®—"><a href="#2-ç»“æ„ä½“æ‰€å å­—èŠ‚é•¿åº¦æ€ä¹ˆè®¡ç®—" class="headerlink" title="2. ç»“æ„ä½“æ‰€å å­—èŠ‚é•¿åº¦æ€ä¹ˆè®¡ç®—"></a>2. ç»“æ„ä½“æ‰€å å­—èŠ‚é•¿åº¦æ€ä¹ˆè®¡ç®—</h3><p>å¯ä»¥ä½¿ç”¨<code>unsafe</code>åŒ…ä¸­çš„<code>Sizeof</code>å‡½æ•°æ¥è®¡ç®—ç»“æ„ä½“æ‰€å å­—èŠ‚é•¿åº¦</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;unsafe&quot;</span><br>)<br><br><span class="hljs-comment">// ç»“æ„ä½“å†…å­˜å¯¹é½é•¿åº¦æ˜¯æŒ‰ç»“æ„ä½“ä¸­æœ€é•¿å­—æ®µå¯¹é½ï¼Œå¦‚ä¸‹ä¸ºint64 - 8å­—èŠ‚</span><br><span class="hljs-comment">// |up| |down|down|score|score|score|score|id|id|id|id|id|id|id|id|</span><br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>Up    <span class="hljs-type">int8</span><br>Down  <span class="hljs-type">int16</span><br>Score <span class="hljs-type">int32</span><br>Id    <span class="hljs-type">int64</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s := Student&#123;<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">98</span>, <span class="hljs-number">123456</span>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;unsafe.Sizeof(s): %v\n&quot;</span>, unsafe.Sizeof(s))<br>&#125;<br></code></pre></td></tr></table></figure><p>output</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unsafe</span>.Sizeof(s): <span class="hljs-number">16</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>interview</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQLä¼˜åŒ–ç­–ç•¥</title>
    <link href="/20230410/sql-optimization-strategy/"/>
    <url>/20230410/sql-optimization-strategy/</url>
    
    <content type="html"><![CDATA[<h3 id="1-MYSQL-ä¼˜åŒ–çš„å‡ ä¸ªåŸåˆ™"><a href="#1-MYSQL-ä¼˜åŒ–çš„å‡ ä¸ªåŸåˆ™" class="headerlink" title="1. MYSQL ä¼˜åŒ–çš„å‡ ä¸ªåŸåˆ™"></a>1. MYSQL ä¼˜åŒ–çš„å‡ ä¸ªåŸåˆ™</h3><ul><li>å‡å°‘æ•°æ®è®¿é—®ï¼šè®¾ç½®åˆç†çš„å­—æ®µç±»å‹ï¼Œå¯ç”¨å‹ç¼©ï¼Œé€šè¿‡ç´¢å¼•è®¿é—®ç­‰å‡å°‘ç£ç›˜ IO</li><li>è¿”å›æ›´å°‘çš„æ•°æ®ï¼šåªè¿”å›éœ€è¦çš„å­—æ®µå’Œæ•°æ®åˆ†é¡µå¤„ç†ï¼Œå‡å°‘ç£ç›˜å’Œç½‘ç»œ IO</li><li>å‡å°‘äº¤äº’æ¬¡æ•°ï¼šæ‰¹é‡ DML æ“ä½œï¼Œå‡½æ•°å­˜å‚¨ç­‰å‡å°‘æ•°æ®è¿æ¥æ¬¡æ•°</li><li>åˆ©ç”¨æ›´å¤šèµ„æºï¼šä½¿ç”¨è¡¨åˆ†åŒºï¼Œå¹¶å¢åŠ å¹¶è¡Œæ“ä½œï¼Œæ›´å¤§é™åº¦åˆ©ç”¨ CPU èµ„æº</li></ul><p>æ€»ç»“ä¸€ä¸‹</p><ul><li>æœ€å¤§åŒ–åˆ©ç”¨ç´¢å¼•</li><li>å°½å¯èƒ½é¿å…å…¨è¡¨æ‰«æ</li><li>å‡å°‘æ— æ•ˆæ•°æ®çš„æŸ¥è¯¢</li></ul><h3 id="2-ä¼˜åŒ–ç­–ç•¥"><a href="#2-ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="2. ä¼˜åŒ–ç­–ç•¥"></a>2. ä¼˜åŒ–ç­–ç•¥</h3><blockquote><p>å£°æ˜ï¼šä»¥ä¸‹ SQL ä¼˜åŒ–ç­–ç•¥é€‚ç”¨äºæ•°æ®é‡è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå°ï¼Œæ²¡å¿…è¦ä»¥æ­¤ä¸ºå‡†ï¼Œä»¥å…ç”»è›‡æ·»è¶³ã€‚</p></blockquote><h4 id="2-1-é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯"><a href="#2-1-é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯" class="headerlink" title="2.1 é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯"></a>2.1 é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯</h4><ol><li>å°½é‡é¿å…åœ¨å­—æ®µå¼€å¤´æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¼•æ“æ”¾å¼ƒç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æ</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># bad<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%ç‹%&#x27;</span><br># good<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;ç‹%&#x27;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦åœ¨å‰é¢ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæä¾›å‡ ä¸ªè§£å†³æ€è·¯ï¼š</p><ul><li>ä½¿ç”¨ MySQL å†…ç½®å‡½æ•°<code>INSTR(str, substr)</code>æ¥åŒ¹é…</li><li>ä½¿ç”¨ FullText å…¨æ–‡ç´¢å¼•ï¼Œç”¨ match against æ£€ç´¢</li><li>æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µï¼Œå»ºè®®å¼•å…¥ ElasticSearchã€solrï¼Œäº¿çº§æ•°æ®é‡æ£€ç´¢é€Ÿåº¦ç§’çº§</li><li>å½“è¡¨æ•°æ®é‡è¾ƒå°‘ï¼ˆå‡ åƒæ¡å·¦å³ï¼‰ï¼Œç›´æ¥<code>like &#39;%xx%&#39;</code></li></ul><span id="more"></span><ol start="2"><li>å°½é‡é¿å…ä½¿ç”¨<code>in</code> å’Œ<code>not in</code>ï¼Œå½“ in çš„å–å€¼èŒƒå›´è¿‡å¤§æ—¶ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¼•æ“èµ°å…¨è¡¨æ‰«æ</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"># bad<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>);<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯è¿ç»­æ•°æ®ï¼Œå¯ç”¨<code>between</code>ä»£æ›¿</li><li>å¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨<code>exists</code>ä»£æ›¿</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">Between</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> <span class="hljs-number">9</span>;<br><br># bad<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t2)<br># good<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> t2.id)<br>#<br></code></pre></td></tr></table></figure><ol start="3"><li><p>å°½é‡é¿å…ä½¿ç”¨ or è¿æ¥<strong>æœªä½¿ç”¨ç´¢å¼•çš„æ¡ä»¶</strong>ï¼Œæˆ–åƒ IN è¿™ç§<strong>è¿‡æ»¤èŒƒå›´ä¸å¤§</strong>çš„æ¡ä»¶ï¼Œä¼šå¯¼è‡´å¼•æ“èµ°å…¨è¡¨æ‰«æ</p></li><li><p>å°½é‡é¿å…ä½¿ç”¨ NULL å€¼åˆ¤æ–­ï¼ŒNULL åˆ¤æ–­ä¼šå¯¼è‡´å¼•æ“èµ°å…¨è¡¨æ‰«æ</p></li><li><p>å°½é‡é¿å…åœ¨æ¡ä»¶<strong>ç­‰å¼çš„å·¦ä¾§</strong>è¿›è¡Œ<strong>è¡¨ç¤ºå¼</strong>æˆ–<strong>å‡½æ•°</strong>æ“ä½œï¼Œä¼šå¯¼è‡´å¼•æ“èµ°å…¨è¡¨æ‰«æ</p></li><li><p>å°½é‡é¿å…ä½¿ç”¨<code>&lt;&gt;</code>æˆ–<code>!=</code>ï¼Œä¼šå¯¼è‡´å¼•æ“èµ°å…¨è¡¨æ‰«æã€‚</p></li><li><p>ä½¿ç”¨è”åˆç´¢å¼•æ£€ç´¢æ—¶ï¼ŒMySQl è”åˆç´¢å¼•<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>, å³ ABC ç´¢å¼•ï¼Œæ¡ä»¶ä¸º AC æˆ– BC éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä½† A,AB å¯ä»¥</p></li><li><p>éšå¼ç±»å‹è½¬æ¢é€ æˆä¸ä½¿ç”¨ç´¢å¼•</p></li><li><p>order by çš„å­—æ®µå¦‚æœæ²¡æœ‰ç´¢å¼•çš„è¯ï¼Œå°†ä¼šè¿›è¡Œå…¨è¡¨æ‰«æ</p></li></ol><h4 id="2-2-SELECT-çš„å…¶ä»–ä¼˜åŒ–"><a href="#2-2-SELECT-çš„å…¶ä»–ä¼˜åŒ–" class="headerlink" title="2.2 SELECT çš„å…¶ä»–ä¼˜åŒ–"></a>2.2 SELECT çš„å…¶ä»–ä¼˜åŒ–</h4>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>Postgres</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goå†…å­˜ç®¡ç†</title>
    <link href="/20230410/golang-memory-management/"/>
    <url>/20230410/golang-memory-management/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ï¼š<a href="https://zhuanlan.zhihu.com/p/76802887">è¯¦è§£ Go è¯­è¨€çš„å†…å­˜æ¨¡å‹åŠå †çš„åˆ†é…ç®¡ç†</a> ,å»ºè®® tm åå¤è§‚çœ‹</p></blockquote><p>golang çš„å†…å­˜ç®¡ç†æ˜¯å€Ÿé‰´äº† TCMalloc(Thread Cache Malloc)ï¼Œéšç€ Go çš„è¿­ä»£ï¼ŒGo çš„å†…å­˜ç®¡ç†ä¸ TCMalloc ä¸ä¸€è‡´çš„åœ°æ–¹ä¹Ÿåœ¨æ‰©å¤§ï¼Œä½†å…¶ä¸»è¦æ€æƒ³æ˜¯ä¸€è‡´çš„ã€‚åªæ˜¯æ¯” TCMalloc å¤šäº†<strong>é€ƒé€¸åˆ†æ</strong>å’Œ<strong>åƒåœ¾å›æ”¶</strong>ã€‚</p><h4 id="åŸºæœ¬æ¶æ„"><a href="#åŸºæœ¬æ¶æ„" class="headerlink" title="åŸºæœ¬æ¶æ„"></a>åŸºæœ¬æ¶æ„</h4><p><img src="https://pic4.zhimg.com/80/v2-1aa731ddd77b6cad73c8f68f864ea5ef_720w.webp" alt="æ¶æ„"></p><ul><li>page: å›¾ä¸­çš„æµ…è“æ–¹å—,åœ¨ x86 æ¶æ„ä¸­ä¸€ä¸ª page å¤§å°ä¸º 8KB</li><li>span: å†…å­˜ç®¡ç†çš„åŸºæœ¬å•ä½ï¼Œç”±ä¸€ç»„è¿ç»­çš„ page ç»„æˆ,å›¾ä¸­çš„æµ…è“é•¿æ–¹å½¢å’Œç´«è‰²æ–¹å—</li><li>mcache: mcache ä¿å­˜çš„æ˜¯å„ç§å¤§å°çš„ Spanï¼Œå¹¶æŒ‰ Span class åˆ†ç±»ï¼Œå°å¯¹è±¡ç›´æ¥ä» mcache åˆ†é…å†…å­˜ï¼Œå®ƒèµ·åˆ°äº†ç¼“å­˜çš„ä½œç”¨ï¼Œå¹¶ä¸”å¯ä»¥æ— é”è®¿é—®ã€‚Go ä¸­æ˜¯æ¯ä¸ª P æ‹¥æœ‰ 1 ä¸ª mcacheã€‚åœ¨ Go ç¨‹åºä¸­ï¼Œå½“å‰æœ€å¤šæœ‰ GOMAXPROCS ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œæ‰€ä»¥æœ€å¤šéœ€è¦ GOMAXPROCS ä¸ª mcache å°±å¯ä»¥ä¿è¯å„çº¿ç¨‹å¯¹ mcache çš„æ— é”è®¿é—®ï¼Œçº¿ç¨‹çš„è¿è¡Œåˆæ˜¯ä¸ P ç»‘å®šçš„ï¼ŒæŠŠ mcache äº¤ç»™ P åˆšåˆšå¥½ã€‚</li><li>mcentral: æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ç¼“å­˜ï¼Œéœ€è¦åŠ é”è®¿é—®ã€‚æŒ‰ Span class å¯¹ Span åˆ†ç±»ï¼Œç„¶åä¸²è”æˆé“¾è¡¨ï¼Œå½“ mcache çš„æŸä¸ª class çš„ Span çš„å†…å­˜è¢«åˆ†é…å…‰æ—¶ï¼Œå®ƒä¼šå‘ mcentral ç”³è¯· 1 ä¸ªå½“å‰çº§åˆ«çš„ Spanã€‚</li><li>mheap: å †å†…å­˜çš„æŠ½è±¡ï¼ŒæŠŠä» OS ç”³è¯·å‡ºçš„å†…å­˜é¡µç»„ç»‡æˆ Spanï¼Œå¹¶ä¿å­˜èµ·æ¥ã€‚å½“ mcentral çš„ Span ä¸å¤Ÿç”¨æ—¶ä¼šå‘ mheap ç”³è¯·å†…å­˜ï¼Œè€Œ mheap çš„ Span ä¸å¤Ÿç”¨æ—¶ä¼šå‘ OS ç”³è¯·å†…å­˜ã€‚mheap å‘ OS çš„å†…å­˜ç”³è¯·æ˜¯æŒ‰é¡µæ¥çš„ï¼Œç„¶åæŠŠç”³è¯·æ¥çš„å†…å­˜é¡µç”Ÿæˆ Span ç»„ç»‡èµ·æ¥ï¼ŒåŒæ ·ä¹Ÿæ˜¯éœ€è¦åŠ é”è®¿é—®çš„ã€‚mheap æŠŠ Span ç»„ç»‡æˆäº†æ ‘ç»“æ„ï¼Œå…± 2 æ£µæ ‘ï¼Œç„¶åæŠŠ Span åˆ†é…åˆ° heapArena è¿›è¡Œç®¡ç†ï¼Œå®ƒåŒ…å«åœ°å€æ˜ å°„å’Œ span æ˜¯å¦åŒ…å«æŒ‡é’ˆç­‰ä½å›¾ï¼Œè¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†æ›´é«˜æ•ˆçš„åˆ©ç”¨å†…å­˜ï¼šåˆ†é…ã€å›æ”¶å’Œå†åˆ©ç”¨ã€‚</li></ul><h4 id="å¤§å°å¯¹è±¡"><a href="#å¤§å°å¯¹è±¡" class="headerlink" title="å¤§å°å¯¹è±¡"></a>å¤§å°å¯¹è±¡</h4><p><img src="https://pic4.zhimg.com/80/v2-14196cbb8fc199f5257fd94617210557_720w.webp" alt="å¯¹è±¡åˆ†ç±»"></p><ul><li>å°å¯¹è±¡(&lt;&#x3D; 32KB)ç›´æ¥åœ¨ mcache ä¸­åˆ†é…</li><li>å¤§å¯¹è±¡(&gt; 32KB)ç›´æ¥ä» mheap ä¸­åˆ†é…</li></ul><span id="more"></span><h4 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h4><blockquote><p>åŸæ–‡è§ï¼š<a href="https://zhuanlan.zhihu.com/p/91559562">golang é€ƒé€¸åˆ†æè¯¦è§£</a> ,å»ºè®® tmd åå¤è§‚çœ‹</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">go run -gcflags &quot;-m -l&quot; main.go<br><span class="hljs-meta prompt_"># </span><span class="language-bash">      -m    æ‰“å°é€ƒé€¸åˆ†æä¿¡æ¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">      -l    ç¦æ­¢å†…è”ç¼–è¯‘)</span><br></code></pre></td></tr></table></figure><p>é€ƒé€¸è§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>åœ¨æŸä¸ªå‡½æ•°å†…éƒ¨<strong>new ç”Ÿæˆçš„æŒ‡é’ˆ</strong>æˆ–è€…<strong>å­—é¢é‡çš„æŒ‡é’ˆ</strong>è¢«å½“æˆå‡½æ•°è¿”å›å€¼ï¼Œåˆ™è¯¥å˜é‡ä¸€å®šå‘ç”Ÿäº†é€ƒé€¸(æ„é€ å‡½æ•°è¿”å›çš„æŒ‡é’ˆä¸€å®šé€ƒé€¸)</li><li>è¢« sliceã€mapã€chan å¼•ç”¨çš„<strong>æŒ‡é’ˆ</strong>ä¸€å®šå‘ç”Ÿäº†é€ƒé€¸<blockquote><p>stack overflow ä¸Šæœ‰äººæé—®ä¸ºä»€ä¹ˆä½¿ç”¨æŒ‡é’ˆçš„ chan æ¯”ä½¿ç”¨å€¼çš„ chan æ…¢ 30%ï¼Œç­”æ¡ˆå°±åœ¨è¿™é‡Œï¼šä½¿ç”¨æŒ‡é’ˆçš„ chan å‘ç”Ÿé€ƒé€¸ï¼Œgc æ‹–æ…¢äº†é€Ÿåº¦ã€‚<a href="https://link.zhihu.com/?target=https://stackoverflow.com/questions/41178729/why-passing-pointers-to-channel-is-slower">Why passing pointers to channel is slower</a></p></blockquote></li><li>è¢«<strong>å·²ç»é€ƒé€¸çš„å˜é‡å¼•ç”¨çš„æŒ‡é’ˆ</strong>ä¸€å®šå‘ç”Ÿäº†é€ƒé€¸</li></ol>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼ è¾“å±‚</title>
    <link href="/20230408/transport-layout/"/>
    <url>/20230408/transport-layout/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Transport Layout</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UDP</title>
    <link href="/20230408/udp-intro/"/>
    <url>/20230408/udp-intro/</url>
    
    <content type="html"><![CDATA[<blockquote><p>UDP åè®®ä»…ä»…åœ¨æä¾›äº†å¤ç”¨&#x2F;åˆ†è§£åŠŸèƒ½å’Œå°‘é‡çš„å·®é”™æ£€éªŒ</p></blockquote><h3 id="1-UDP-æŠ¥æ–‡ç»“æ„"><a href="#1-UDP-æŠ¥æ–‡ç»“æ„" class="headerlink" title="1. UDP æŠ¥æ–‡ç»“æ„"></a>1. UDP æŠ¥æ–‡ç»“æ„</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// ä»£ç ç¤ºä¾‹ï¼ŒçœŸæ­£æŠ¥æ–‡ç»“æ„ä¸ºäºŒè¿›åˆ¶</span><br><span class="hljs-keyword">type</span> <span class="hljs-keyword">struct</span> udp &#123;<br>    <span class="hljs-comment">// header</span><br>    source_port <span class="hljs-type">int16</span> <span class="hljs-comment">//æºç«¯ç«¯å£</span><br>    target_port <span class="hljs-type">int16</span> <span class="hljs-comment">//ç›®çš„ç«¯å£</span><br>    length      <span class="hljs-type">int16</span> <span class="hljs-comment">//é•¿åº¦</span><br>    checksum    <span class="hljs-type">int16</span> <span class="hljs-comment">//æ£€éªŒå’Œ</span><br>    <span class="hljs-comment">// body</span><br>    data        []<span class="hljs-type">byte</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¤´éƒ¨å…±å››ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µç”±ä¸¤ä¸ªå­—èŠ‚ç»„æˆï¼Œå…±è®¡ 8 ä¸ªå­—èŠ‚</p><h3 id="2-UDP-æ£€éªŒå’Œ"><a href="#2-UDP-æ£€éªŒå’Œ" class="headerlink" title="2. UDP æ£€éªŒå’Œ"></a>2. UDP æ£€éªŒå’Œ</h3><p>è®¡ç®—æ£€éªŒå’Œæ—¶ï¼ŒåŠ å…¥ä¼ªå¤´éƒ¨</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> <span class="hljs-keyword">struct</span> udp_virtual_header &#123;<br>    source_ip  <span class="hljs-type">int32</span><br>    target_ip  <span class="hljs-type">int32</span><br>    _          <span class="hljs-type">int8</span><br>    udp_type   <span class="hljs-type">int8</span><br>    udp_length <span class="hljs-type">int16</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å°†ä¼ªå¤´éƒ¨å’ŒæŠ¥æ–‡ä¸­æ‰€æœ‰ 16bit å­—(2Byte)ç›¸åŠ ï¼Œdata æœ€åä¸è¶³ 16bit è¡¥é›¶ã€‚æº¢å‡ºä½å›å·(å›å·ï¼šæº¢å‡ºä½å’Œ 16bit ç›¸åŠ )ï¼Œç„¶åè¿›è¡Œåç è¿ç®—ã€‚<br>åœ¨æ ¡éªŒæ—¶ï¼Œå°†ä¼ªå¤´éƒ¨å’ŒæŠ¥æ–‡ä¸­æ‰€æœ‰ 16bit å­—ç›¸åŠ ï¼Œå’Œä¸º 1111111111111111 åˆ™æ ¡éªŒæˆåŠŸï¼Œåä¹‹å¤±è´¥,è¯´æ˜æŠ¥æ–‡å—æŸã€‚</p><h3 id="3-UDP-ç›¸å¯¹äº-TCP-çš„ä¼˜åŠ¿"><a href="#3-UDP-ç›¸å¯¹äº-TCP-çš„ä¼˜åŠ¿" class="headerlink" title="3. UDP ç›¸å¯¹äº TCP çš„ä¼˜åŠ¿"></a>3. UDP ç›¸å¯¹äº TCP çš„ä¼˜åŠ¿</h3><ul><li>æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œæ›´é€‚åˆåŠæ—¶æ€§è´¨çš„ä¼ è¾“</li><li>æ— éœ€å»ºç«‹è¿æ¥ï¼Œç›¸æ¯”äº TCP æœ‰æ›´ä½çš„æ—¶å»¶</li><li>æ— çŠ¶æ€è¿æ¥ï¼Œæ— éœ€åƒ TCP ä¸€èˆ¬ç»´æŠ¤è¿æ¥çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼šæ¥å—å’Œå‘é€ç¼“å­˜ã€æ‹¥å¡æ§åˆ¶å‚æ•°ã€åºå·å’Œç¡®è®¤å·ç­‰ï¼‰</li><li>é¦–éƒ¨å¼€é”€æ›´å°ï¼ŒUDP å¤´éƒ¨ 8Byte, TCP é¦–éƒ¨ 20Byte</li></ul>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>UDP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>httpç®€ä»‹</title>
    <link href="/20230406/http-intro/"/>
    <url>/20230406/http-intro/</url>
    
    <content type="html"><![CDATA[<h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h3><h3 id="2-HTTP-æŠ¥æ–‡"><a href="#2-HTTP-æŠ¥æ–‡" class="headerlink" title="2. HTTP æŠ¥æ–‡"></a>2. HTTP æŠ¥æ–‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dot"><br></code></pre></td></tr></table></figure><h3 id="3-æŒç»­è¿æ¥å’ŒéæŒç»­è¿æ¥"><a href="#3-æŒç»­è¿æ¥å’ŒéæŒç»­è¿æ¥" class="headerlink" title="3. æŒç»­è¿æ¥å’ŒéæŒç»­è¿æ¥"></a>3. æŒç»­è¿æ¥å’ŒéæŒç»­è¿æ¥</h3><ul><li><p>HTTP&#x2F;1.0 é»˜è®¤ä½¿ç”¨éæŒç»­è¿æ¥ï¼Œå¦‚è¦ä½¿ç”¨æŒç»­è¿æ¥ï¼Œåœ¨æŠ¥æ–‡å¤´éƒ¨æ·»åŠ <code>Connection: keep-alive</code></p></li><li><p>HTTP&#x2F;1.1 é»˜è®¤ä½¿ç”¨æŒç»­è¿æ¥ï¼Œå¦‚è¦ä½¿ç”¨éæŒç»­è¿æ¥ï¼Œåœ¨æŠ¥æ–‡å¤´éƒ¨æ·»åŠ <code>Connection: close</code></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTTP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Debug</title>
    <link href="/20221103/golang-debug/"/>
    <url>/20221103/golang-debug/</url>
    
    <content type="html"><![CDATA[<h3 id="1-pprof"><a href="#1-pprof" class="headerlink" title="1. pprof"></a>1. pprof</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-comment">// import pprof to init</span><br>_ <span class="hljs-string">&quot;net/http/pprof&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">if</span> err := http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-1-web"><a href="#1-1-web" class="headerlink" title="1.1 web"></a>1.1 web</h4><p>http è®¿é—®<code>http://localhost:8080/debug/pprof</code>å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹<br><img src="https://i.imgur.com/KUmRUa9.png" alt="pprof"></p><ul><li>å†…å­˜åˆ†é…</li><li>goroutineæ•°é‡</li><li>å †åˆ†é…</li><li>èµ„æºç«äº‰</li><li>çº¿ç¨‹åˆ›å»º</li><li>ç­‰</li></ul><h4 id="1-2-go-tool"><a href="#1-2-go-tool" class="headerlink" title="1.2 go tool"></a>1.2 <code>go tool</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go tool pprof -http=:8000 http://127.0.0.1:8080/debug/pprof/profile</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">go tool pprof -http=:8000 cpu.out</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">go tool pprof -http=:8000 pprof.XXX.samples.cpu.001.pb.gz</span><br></code></pre></td></tr></table></figure><p>å¼€å¯å¦ä¸€ä¸ªwebæœåŠ¡åˆ†æè·å–çš„ä¿¡æ¯ï¼Œæµè§ˆå™¨æ‰“å¼€<code>http://localhost:8000</code>å³å¯æŸ¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢<br><img src="https://i.imgur.com/z1SKdPS.png" alt="pprof"><br>å¹¶åŒ…å«æœ‰ç«ç„°å›¾</p>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golangç¬ºè¨€</title>
    <link href="/20220806/golang-proverbs/"/>
    <url>/20220806/golang-proverbs/</url>
    
    <content type="html"><![CDATA[<!-- åˆšæ¯•ä¸šçš„æˆ‘å°±è¢«å…¬å¸ä»¥æŸäº›ç†ç”±ç‚’äº†ï¼Œæ‰€ä»¥æˆ‘æ¥ç»§ç»­å­¦ä¹ äº†<span class="github-emoji" alias="sob" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8">&#x1f62d;</span> --><p>æœ¬ç¯‡æ–‡ç« æ˜¯å­¦ä¹ <a href="https://github.com/cristaloleg/go-advice">go-advice</a>æ—¶æ‰€å†™ï¼ŒåŒ…å«äº†å¤§éƒ¨åˆ†å†™ go éœ€è¦æ³¨æ„çš„ç‚¹</p><h3 id="1-è°è¨€"><a href="#1-è°è¨€" class="headerlink" title="1. è°è¨€"></a>1. è°è¨€</h3><ul><li>ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡é€šä¿¡å…±äº«å†…å­˜</li><li>å¹¶å‘ä¸æ˜¯å¹¶è¡Œ <span class="github-emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">&#x2714;</span></li><li>ç®¡é“ç”¨äºåè°ƒï¼›äº’æ–¥é‡ï¼ˆé”ï¼‰ç”¨äºåŒæ­¥ <span class="github-emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">&#x2714;</span></li><li>æ¥å£è¶Šå¤§ï¼ŒæŠ½è±¡è¶Šå¼± <span class="github-emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">&#x2714;</span></li><li>åˆ©ç”¨å¥½é›¶å€¼</li><li>ç©ºç»“æ„<code>interface&#123;&#125;</code>å³<code>any</code>æ²¡æœ‰ä»»ä½•ç±»å‹çº¦æŸ <span class="github-emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">&#x2714;</span></li><li>gofmt çš„é£æ ¼ä¸æ˜¯äººä»¬æœ€å–œæ¬¢çš„ï¼Œä½† gofmt æ˜¯æ¯ä¸ªäººçš„æœ€çˆ±</li><li>ä¸€ç‚¹ç‚¹é‡å¤æ¯”å¼•å…¥ä¸€ç‚¹ç‚¹ä¾èµ–æ›´å¥½</li><li>å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡è®°ä¿æŠ¤ç³»ç»Ÿè°ƒç”¨å’Œ cgo</li><li>cgo ä¸æ˜¯ go</li><li>ä½¿ç”¨<code>unsafe</code>ä¸èƒ½ä¿è¯èƒ½å¦‚æœŸè¿è¡Œ</li><li>æ¸…æ™°æ¯”èªæ˜æ›´å¥½</li><li>åå°„æ°¸è¿œä¸æ¸…æ™°</li><li>é”™è¯¯æ˜¯å€¼</li><li>ä¸è¦åªæ£€æŸ¥é”™è¯¯ï¼Œè¿˜è¦ä¼˜é›…çš„å¤„ç†å®ƒä»¬</li><li>è®¾è®¡æ¶æ„ï¼Œå‘½åç»„ä»¶ï¼Œæ–‡æ¡£è®°å½•ç»†èŠ‚</li><li>æ–‡æ¡£æ˜¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„</li><li>ä¸è¦ï¼ˆåœ¨ç”Ÿäº§ç¯å¢ƒï¼‰ä½¿ç”¨<code>panic()</code></li></ul><span id="more"></span><h3 id="2-ç›®æ ‡"><a href="#2-ç›®æ ‡" class="headerlink" title="2. ç›®æ ‡"></a>2. ç›®æ ‡</h3><ul><li>æ¯ä¸ª package å®ç°å•ä¸€çš„ç›®çš„</li><li>æ˜¾ç¤ºå¤„ç†é”™è¯¯</li><li>å°½æ—©è¿”å›ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ·±åµŒå¥—</li><li>è®©è°ƒç”¨è€…å¤„ç†å¹¶å‘ï¼ˆå¸¦æ¥çš„é—®é¢˜ï¼‰</li><li>åœ¨å¯åŠ¨ä¸€ä¸ª goroutine æ—¶ï¼Œéœ€è¦çŸ¥é“å®ƒä½•æ—¶ä¼šåœæ­¢</li><li>é¿å… package çº§åˆ«çš„çŠ¶æ€</li><li>ç®€å•å¾ˆé‡è¦</li><li>ç¼–å†™æµ‹è¯•ä»¥é”å®š package API çš„è¡Œä¸º</li><li>å¦‚æœä½ è§‰å¾—å¾ˆæ…¢ï¼Œå…ˆç¼–å†™ benchmark æ¥è¯æ˜</li><li>é€‚åº¦æ˜¯ä¸€ç§ç¾å¾·</li><li>å¯ç»´æŠ¤æ€§</li></ul><h3 id="3-ä»£ç "><a href="#3-ä»£ç " class="headerlink" title="3. ä»£ç "></a>3. ä»£ç </h3><ul><li><p>ä½¿ç”¨<code>go fmt</code>æ ¼å¼åŒ–</p><blockquote><p>è®©å›¢é˜Ÿä¸€èµ·ä½¿ç”¨å®˜æ–¹çš„ Go æ ¼å¼åŒ–å·¥å…·ï¼Œä¸è¦é‡æ–°å‘æ˜è½®å­ï¼Œå°è¯•å‡å°‘ä»£ç å¤æ‚åº¦ï¼Œä½¿ä»£ç æ›´æ˜“äºé˜…è¯»</p></blockquote></li><li><p>å¤šä¸ª if è¯­å¥æŠ˜å æˆ switch</p></li><li><p>ä½¿ç”¨<code>chan struct&#123;&#125;</code>æ¥ä¼ é€’ä¿¡å·ï¼Œ<code>chan bool</code>è¡¨è¾¾ä¸å¤Ÿæ¸…æ¥š</p></li><li><p><code>30 * time.Second</code>æ¯”<code>time.Duration(30) * time.Second</code>æ›´å¥½</p></li><li><p>ç”¨<code>time.Duration</code>æ›¿ä»£<code>int64</code>+å˜é‡å</p></li><li><p>æŒ‰ç±»å‹åˆ†ç»„<code>const</code>å£°æ˜ï¼ŒæŒ‰é€»è¾‘æˆ–ç±»å‹åˆ†ç»„<code>var</code></p></li><li><p>æ¯ä¸ª<strong>é˜»å¡</strong>æˆ–è€…<strong>IO å‡½æ•°</strong>æ“ä½œåº”è¯¥æ˜¯å¯å–æ¶ˆæˆ–è€…è‡³å°‘æ˜¯å¯è¶…æ—¶çš„</p></li><li><p>ä¸ºæ•´å‹å¸¸é‡å€¼å®ç°<code>Stringer</code><a href="https://godoc.org/golang.org/x/tools/cmd/stringer"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a>æ¥å£</p></li><li><p>æ£€æŸ¥<code>defer</code>ä¸­çš„é”™è¯¯</p></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;<br>    err := body.Clost()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¸è¦åœ¨<code>checkErr</code>å‡½æ•°ä¸­ä½¿ç”¨<code>panic()</code>æˆ–<code>os.Exit()</code></li><li>ä»…ä»…åœ¨å¾ˆç‰¹æ®Šçš„æƒ…å†µä¸‹æ‰ä½¿ç”¨<code>panic()</code>ï¼Œä½ å¿…é¡»è¦å»å¤„ç†<code>error</code></li><li>ä¸è¦ç»™æšä¸¾ä½¿ç”¨åˆ«åï¼Œå› ä¸ºè¿™æ ·æ‰“ç ´äº†ç±»å‹å®‰å…¨<a href="https://play.golang.org/p/MGbeDwtXN3"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">type</span> Status = <span class="hljs-type">int</span><br><span class="hljs-keyword">type</span> Format = <span class="hljs-type">int</span> <span class="hljs-comment">// remove `=` to have type safety</span><br><br><span class="hljs-keyword">const</span> A Status = <span class="hljs-number">1</span><br><span class="hljs-keyword">const</span> B Format = <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-built_in">println</span>(A == B) <span class="hljs-comment">// true, but a.type != b.type</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä½ æƒ³çœç•¥è¿”å›å‚æ•°ï¼Œä½ æœ€å¥½è¡¨ç¤ºå‡ºæ¥ï¼Œ<code>_ = f()</code>æ¯”<code>f()</code>æ›´å¥½</li><li>æˆ‘ä»¬ç”¨<code>a := []T&#123;&#125;</code>ç®€å•åˆå§‹åŒ– slice</li><li>ç”¨ range å¾ªç¯æ¥è¿›è¡Œæ•°ç»„æˆ– slice çš„è¿­ä»£</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// æ›´å¥½</span><br><span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> a[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>] &#123; ... &#125;<br><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">3</span>; i &lt; <span class="hljs-number">7</span>; i++ &#123; ...&#125;<br><br></code></pre></td></tr></table></figure><ul><li>å¤šè¡Œå­—ç¬¦ä¸²ç”¨åå¼•å·</li><li>ç”¨<code>_</code>æ¥è·³è¿‡ä¸ç”¨çš„å‚æ•°</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">(a <span class="hljs-type">int</span>, _ <span class="hljs-type">string</span>)</span></span> &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä½ è¦æ¯”è¾ƒæ—¶é—´æˆ³ï¼Œè¯·ä½¿ç”¨<code>time.Before()</code>æˆ–<code>time.After()</code>ï¼Œä¸è¦ä½¿ç”¨<code>time.Sub()</code>æ¥è·å¾— durationï¼Œç„¶åæ£€æŸ¥ä»–çš„å€¼</li><li>å¸¦æœ‰ä¸Šä¸‹æ–‡çš„å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°åä¸º<code>ctx</code>ï¼Œå½¢å¦‚<code>func foo(ctx Context, ...)</code></li><li>å‡ ä¸ªç±»å‹ç›¸åŒçš„å‚æ•°å®šä¹‰å¯ä»¥ç”¨ç®€çŸ­çš„æ–¹å¼æ¥å®šä¹‰ï¼Œ<code>func f(a int, b, c string)</code></li><li>ä¸€ä¸ª slice çš„é›¶å€¼æ˜¯ nil<br><a href="https://play.golang.org/p/pNT0d_Bunq"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> s []<span class="hljs-type">int</span><br>fmt.Println(s, <span class="hljs-built_in">len</span>(s), <span class="hljs-built_in">cap</span>(s))<br><span class="hljs-keyword">if</span> s == <span class="hljs-literal">nil</span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;nil!&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// Output:</span><br><span class="hljs-comment">// [] 0 0</span><br><span class="hljs-comment">// nil!</span><br></code></pre></td></tr></table></figure><p><a href="https://play.golang.org/p/meTInNyxtk"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> a []<span class="hljs-type">string</span><br>b := []<span class="hljs-type">string</span>&#123;&#125;<br><br>fmt.Println(reflect.DeepEqual(a, []<span class="hljs-type">string</span>&#123;&#125;))<br>fmt.Println(reflect.DeepEqual(b, []<span class="hljs-type">string</span>&#123;&#125;))<br><span class="hljs-comment">// Output:</span><br><span class="hljs-comment">// false</span><br><span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><ul><li>ä¸è¦å°†æšä¸¾ç±»å‹ä¸<code>&lt;</code>,<code>&gt;</code>,<code>&lt;=</code>,<code>&gt;=</code>è¿›è¡Œæ¯”è¾ƒï¼Œä½¿ç”¨ç¡®å®šçš„å€¼</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang">value := reflect.ValueOf(object)<br>kind := value.Kind()<br><span class="hljs-keyword">if</span> kind &gt;= reflect.Chan &amp;&amp; kind &lt;= reflect.Slice &#123;<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç”¨<code>%+v</code>æ¥æ‰“å°æ•°æ®æ¯”è¾ƒå…¨çš„ä¿¡æ¯</li><li>æ³¨æ„ç©ºç»“æ„<code>struct&#123;&#125;</code>ï¼Œçœ‹ issue: <a href="https://github.com/golang/go/issues/23440">golang&#x2F;go#23440</a> or <a href="https://play.golang.org/p/9C0puRUstrP"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f1</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> a, b <span class="hljs-keyword">struct</span>&#123;&#125;<br>    <span class="hljs-built_in">print</span>(&amp;a, <span class="hljs-string">&quot;\n&quot;</span>, &amp;b, <span class="hljs-string">&quot;\n&quot;</span>) <span class="hljs-comment">// Prints same address</span><br>    fmt.Println(&amp;a == &amp;b)     <span class="hljs-comment">// Comparison returns false</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f2</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> a, b <span class="hljs-keyword">struct</span>&#123;&#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%p\n%p\n&quot;</span>, &amp;a, &amp;b) <span class="hljs-comment">// Again, same address</span><br>    fmt.Println(&amp;a == &amp;b)          <span class="hljs-comment">// ...but the comparison returns true</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åŒ…è£…é”™è¯¯<a href="http://github.com/pkg/errors"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a>ï¼Œå¦‚<code>errors.Wrap(err, &quot;additional message to a given error&quot;)</code></li><li>åœ¨ go é‡Œè¦å°å¿ƒä½¿ç”¨<code>range</code><ol><li><code>for i := range a</code>å’Œ<code>for i,v := range &amp;a</code>ï¼Œéƒ½ä¸æ˜¯<code>a</code>çš„å‰¯æœ¬</li><li><code>for i, v := range a</code>é‡Œé¢å°±æ˜¯<code>a</code>çš„å‰¯æœ¬</li><li>more <a href="https://play.golang.org/p/4b181zkB1O"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ol></li><li>ä» map é‡Œè¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key ä¸ä¼š panic</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang">value := <span class="hljs-keyword">map</span>[<span class="hljs-string">&quot;no_key&quot;</span>]  <span class="hljs-comment">// return 0</span><br><br><span class="hljs-comment">// well</span><br>value, ok := <span class="hljs-keyword">map</span>[<span class="hljs-string">&quot;no_key&quot;</span>] <span class="hljs-comment">// return 0, false and check ok</span><br></code></pre></td></tr></table></figure><ul><li>ä¸è¦ä½¿ç”¨åŸå§‹å‚æ•°è¿›è¡Œæ–‡ä»¶æ“ä½œ</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// bad</span><br>os.MkdirAll(path, <span class="hljs-number">0700</span>)<br><br><span class="hljs-comment">// good</span><br>os.MkdirAll(path, os.FileMode)<br></code></pre></td></tr></table></figure><ul><li>è¦ä¸å¿˜è®°å¯¹<code>iota</code>æŒ‡å®šä¸€ç§ç±»å‹<a href="https://play.golang.org/p/mZZdMaI92cI"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">const</span> (<br>  _ = <span class="hljs-literal">iota</span><br>  testvar         <span class="hljs-comment">// testvar å°†æ˜¯ int ç±»å‹</span><br>)<br><br><span class="hljs-keyword">type</span> myType <span class="hljs-type">int</span><br><span class="hljs-keyword">const</span> (<br>  _ myType = <span class="hljs-literal">iota</span><br>  testvar         <span class="hljs-comment">// testvar å°†æ˜¯ myType ç±»å‹</span><br>)<br></code></pre></td></tr></table></figure><ul><li>ä¸è¦åœ¨ä½ ä¸æ‹¥æœ‰çš„ç»“æ„ä¸Šä½¿ç”¨<code>encoding/gob</code>ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œç»“æ„å¯èƒ½ä¼šæ”¹å˜ï¼Œè€Œä½ å¯èƒ½ä¼šé”™è¿‡è¿™ä¸€ç‚¹ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¾ˆéš¾æ‰¾åˆ° bugã€‚</li><li>ä¸è¦ä¾èµ–äºè®¡ç®—é¡ºåºï¼Œç‰¹åˆ«æ˜¯åœ¨<code>return</code>è¯­å¥ä¸­</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// BAD</span><br><span class="hljs-keyword">return</span> res, json.Unmarshal(b, &amp;res)<br><br><span class="hljs-comment">// GOOD</span><br>err := json.Unmarshal(b, &amp;res)<br><span class="hljs-keyword">return</span> res, err<br></code></pre></td></tr></table></figure><ul><li>é˜²æ­¢ç»“æ„ä½“å­—æ®µç”¨çº¯å€¼æ–¹å¼åˆå§‹åŒ–ï¼Œæ·»åŠ <code>_ struct&#123;&#125;</code>å­—æ®µ</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Point <span class="hljs-keyword">struct</span> &#123;<br>  X, Y <span class="hljs-type">float64</span><br>  _    <span class="hljs-keyword">struct</span>&#123;&#125; <span class="hljs-comment">// to prevent unkeyed literals</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    p1 := Point&#123;X: <span class="hljs-number">1</span>, Y: <span class="hljs-number">1</span>&#125;<br>    p2 := Point&#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;           <span class="hljs-comment">// compile error</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é˜²æ­¢ç»“æ„æ¯”è¾ƒï¼Œå¯ä»¥æ·»åŠ <code>func</code>ç±»å‹çš„ç©ºå­—æ®µ</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Point <span class="hljs-keyword">struct</span> &#123;<br>    _ [<span class="hljs-number">0</span>]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-comment">// unexported, zero-width non-comparable field</span><br>    X, Y <span class="hljs-type">float64</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    p1, p2 := Point(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>), Point(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<br>    fmt.Println(p1 == p2)   <span class="hljs-comment">// æ­£å¸¸è¾“å‡ºtrueï¼Œä½†æ·»åŠ funcç©ºå­—æ®µåä¼šç¼–è¯‘æŠ¥é”™</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>http.HandlerFunc</code>æ¯”<code>http.Handler</code>æ›´å¥½ï¼Œ<code>http.HandlerFunc</code>åªéœ€è¦ä¸€ä¸ª funcï¼Œ<code>http.Handler</code>éœ€è¦ä¸€ä¸ªç±»å‹</li><li><code>defer</code>ç§»åŠ¨è‡³é¡¶éƒ¨ï¼Œæé«˜ä»£ç å¯é æ€§ï¼Œå¹¶æ˜ç¡®å‡½æ•°ç»“æŸè°ƒç”¨äº†ä»€ä¹ˆ</li><li>JS è§£ææ•´æ•°ä¸ºæµ®ç‚¹æ•°å¯èƒ½ä¼šå¯¼è‡´ int64 æº¢å‡ºï¼Œä½¿ç”¨<code>json:&quot;id,string&quot;</code></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Request <span class="hljs-keyword">struct</span> &#123;<br>    ID <span class="hljs-type">int64</span> <span class="hljs-string">`json:&quot;id,string&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-å¹¶å‘"><a href="#4-å¹¶å‘" class="headerlink" title="4. å¹¶å‘"></a>4. å¹¶å‘</h3><ul><li>ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼åˆ›å»ºå•ä¾‹ï¼ˆåªåˆ›å»ºä¸€æ¬¡ï¼‰çš„æœ€å¥½é€‰æ‹©æ˜¯<code>sync.Once</code>ï¼Œä¸è¦ä½¿ç”¨ flagsã€mutexesã€channels or atomics</li><li>æ°¸è¿œä¸è¦ä½¿ç”¨<code>select&#123;&#125;</code>ï¼Œçœç•¥é€šé“ï¼Œç­‰å¾…ä¿¡å· <span class="github-emoji" alias="question" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8">&#x2753;</span></li><li>ä¸è¦å…³é—­ä¸€ä¸ªå‘é€ï¼ˆå†™å…¥ï¼‰é€šé“ï¼Œåº”è¯¥ç”±åˆ›å»ºè€…å…³é—­ï¼ˆ<span class="github-emoji" alias="warning" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8">&#x26a0;</span>å¾€ä¸€ä¸ªå…³é—­çš„ channel é‡Œå†™æ•°æ®ä¼š panicï¼‰</li><li><code>math/rand</code>ä¸­çš„<code>func NewSource(seed int64) Source</code>ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œé»˜è®¤çš„<code>lockedSource</code>æ˜¯å¹¶å‘å®‰å…¨çš„<a href="https://github.com/golang/go/issues/3611"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a> or <a href="https://golang.org/pkg/math/rand/"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>å½“ä½ éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çš„ aotmic å€¼æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>atomic.Value</code></li></ul><h3 id="5-æ€§èƒ½"><a href="#5-æ€§èƒ½" class="headerlink" title="5. æ€§èƒ½"></a>5. æ€§èƒ½</h3><ul><li>ä¸è¦çœç•¥<code>defer</code>ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ 200ns åŠ é€Ÿå¯ä»¥å¿½ç•¥ä¸è®¡</li><li>æ€»æ˜¯å…³é—­ http bodyï¼Œ<code>defer r.Body.Close()</code>ï¼Œé™¤éä½ éœ€è¦æ³„æ¼ goroutine</li><li>è¿‡æ»¤ä¸éœ€è¦åˆ†é…æ–°å†…å­˜</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs golang">b := a[:<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> _, x := <span class="hljs-keyword">range</span> a &#123;<br>    <span class="hljs-keyword">if</span> condition &#123;<br>        b = <span class="hljs-built_in">append</span>(b, x)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä¸ºäº†å¸®åŠ©ç¼–è¯‘å™¨åˆ é™¤ç»‘å®šæ£€æŸ¥ï¼Œå‚è€ƒ`_ = b[7]`</span><br></code></pre></td></tr></table></figure><ul><li><code>time.Time</code>æœ‰æŒ‡é’ˆå­—æ®µ<code>time.Location</code>å¹¶ä¸”è¿™å¯¹ go GC ä¸å¥½ï¼Œåªæœ‰ä½¿ç”¨äº†å¤§é‡çš„<code>time.Time</code>å¯¹æ€§èƒ½æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ä½¿ç”¨ timestamp ä»£æ›¿</li><li><code>regexp.MustCompile</code>æ¯”<code>regexp.Compile</code>æ›´å¥½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥ä½ æœ€å¥½åœ¨<code>func init</code>ä¸­åˆå§‹åŒ–å®ƒ</li><li>è¯·å‹¿åœ¨ä½ çš„çƒ­ç‚¹ä»£ç ä¸­è¿‡åº¦ä½¿ç”¨<code>fmt.Sprintf</code>ï¼Œç”±äºç»´æŠ¤æ¥å£çš„ç¼“å†²æ± å’ŒåŠ¨æ€è°ƒåº¦ï¼Œå®ƒæ˜¯å¾ˆæ˜‚è´µçš„</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs golang">res := fmt.Sprintf(<span class="hljs-string">&quot;%s%s&quot;</span>, str1, str2)<br><span class="hljs-comment">// may be</span><br>res := str1 + str2<br><br>res = fmt.Sprintf(<span class="hljs-string">&quot;%x&quot;</span>,<span class="hljs-keyword">var</span>)<br><span class="hljs-comment">// may be</span><br>res = strconv.FormatInt(<span class="hljs-keyword">var</span>, <span class="hljs-number">16</span>)<br><br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä½ ä¸éœ€è¦å®ƒï¼Œå¯ä»¥è€ƒè™‘ä¸¢å¼ƒå®ƒï¼Œä¾‹å¦‚<code>io.Copy(ioutil.Discard, resp.Body)</code>ï¼ŒHTTP å®¢æˆ·ç«¯çš„ä¼ è¾“ä¸ä¼šé‡æ–°è¿æ¥ï¼Œç›´åˆ° body è¢«è¯»å®Œæˆ–å…³é—­</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang">res, _ := client.Do(req)<br>io.Copy(ioutil.Discard, res.Body)<br><span class="hljs-keyword">defer</span> res.Body.Close()<br></code></pre></td></tr></table></figure><ul><li>ä¸è¦åœ¨å¾ªç¯é‡Œä½¿ç”¨ deferï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¿™äº› defer ä¼šä¸æ–­åœ°å¡«æ»¡ä½ çš„æ ˆï¼ˆå†…å­˜ï¼‰</li><li>ä¸è¦å¿˜è®°åœæ­¢ tickerï¼Œé™¤éä½ éœ€è¦æ³„æ¼ channel</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs golang">ticker := time.NewTicker(<span class="hljs-number">1</span> * time.Second)<br><span class="hljs-keyword">defer</span> ticker.Stop()<br></code></pre></td></tr></table></figure><ul><li>ç”¨è‡ªå®šä¹‰çš„ marshaler å»åŠ é€Ÿ marshal è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒä¹‹å‰è¦è¿›è¡Œå®šåˆ¶ï¼<a href="https://play.golang.org/p/SEm9Hvsi0r"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(entry Entry)</span></span> MarshalJSON() ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) &#123;<br>    buffer := bytes.NewBufferString(<span class="hljs-string">&quot;&#123;&quot;</span>)<br>    first := <span class="hljs-literal">true</span><br>    <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> entry &#123;<br>        jsonValue, err := json.Marshal(value)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>        &#125;<br>        <span class="hljs-keyword">if</span> !first &#123;<br>            buffer.WriteString(<span class="hljs-string">&quot;,&quot;</span>)<br>        &#125;<br>        first = <span class="hljs-literal">false</span><br>        buffer.WriteString(key + <span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-type">string</span>(jsonValue))<br>    &#125;<br>    buffer.WriteString(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>    <span class="hljs-keyword">return</span> buffer.Bytes(), <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>sync.Map</code>æ˜¯ä¸‡èƒ½çš„ï¼Œæ²¡æœ‰è¿‡ç¡¬çš„ç†ç”±å°±è¦ä¸ä½¿ç”¨å®ƒ <a href="https://github.com/golang/go/blob/master/src/sync/map.go#L12"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>åœ¨<code>sync.Pool</code>ä¸­åˆ†é…å†…å­˜å­˜å‚¨éæŒ‡é’ˆæ•°æ® <a href="https://github.com/dominikh/go-tools/blob/master/cmd/staticcheck/docs/checks/SA6002"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>ä¸ºäº†éšè—é€ƒç”Ÿåˆ†æçš„æŒ‡é’ˆï¼Œä½ å¯ä»¥å°å¿ƒä½¿ç”¨è¿™ä¸ªå‡½æ•° <a href="https://go-review.googlesource.com/c/go/+/86976"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// noescape hides a pointer from escape analysis.  noescape is</span><br><span class="hljs-comment">// the identity function but escape analysis doesn&#x27;t think the</span><br><span class="hljs-comment">// output depends on the input. noescape is inlined and currently</span><br><span class="hljs-comment">// compiles down to zero instructions.</span><br><span class="hljs-comment">//go:nosplit</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">noescape</span><span class="hljs-params">(p unsafe.Pointer)</span></span> unsafe.Pointer &#123;<br>    x := <span class="hljs-type">uintptr</span>(p)<br>    <span class="hljs-keyword">return</span> unsafe.Pointer(x ^ <span class="hljs-number">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¯¹äºæœ€å¿«çš„åŸå­äº¤æ¢ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>m := (*map[int]int)(atomic.LoadPointer(&amp;ptr))</code> <span class="github-emoji" alias="question" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8">&#x2753;</span></li><li>å¦‚æœæ‰§è¡Œè®¸å¤šé¡ºåºè¯»å–æˆ–å†™å…¥æ“ä½œï¼Œè¯·ä½¿ç”¨ç¼“å†² I&#x2F;Oï¼Œä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°</li><li>ä¸¤ç§æ¸…ç©ºä¸€ä¸ª map çš„æ–¹æ³•</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// é‡ç”¨mapå†…å­˜ï¼ˆä½†æ˜¯ä¹Ÿè¦æ³¨æ„mçš„å›æ”¶ï¼‰</span><br><span class="hljs-keyword">for</span> k := <span class="hljs-keyword">range</span> m &#123;<br>    <span class="hljs-built_in">delete</span>(m, k)<br>&#125;<br><br><span class="hljs-comment">// ç»™måˆ†é…æ–°çš„å†…å­˜</span><br>m = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">int</span>)<br></code></pre></td></tr></table></figure><h3 id="6-æ¨¡å—"><a href="#6-æ¨¡å—" class="headerlink" title="6. æ¨¡å—"></a>6. æ¨¡å—</h3><ul><li>å¦‚æœä½ æƒ³åœ¨ CI ä¸­æµ‹è¯•<code>go.mod</code>å’Œ<code>go.sum</code>æ˜¯å¦æ˜¯æœ€æ–°<a href="https://blog.urth.org/2019/08/13/testing-go-mod-tidiness-in-ci/"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><h3 id="7-æ„å»º"><a href="#7-æ„å»º" class="headerlink" title="7. æ„å»º"></a>7. æ„å»º</h3><ul><li>ç”¨<code>go build -ldflags=&quot;-s -w&quot; ...</code>å»æ‰ä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶</li><li>æ‹†åˆ†æ„å»ºä¸åŒç‰ˆæœ¬çš„ç®€å•æ–¹æ³•ï¼Œç”¨<code>// + build integration</code>å¹¶ä¸”è¿è¡Œä»–ä»¬<code>go test -v --tags integration</code></li><li>æ„å»ºæœ€å°çš„ Go Docker é•œåƒ<a href="https://twitter.com/bbrodriges/status/873414658178396160"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">CGO_ENABLED=0 go build -ldflags=&quot;-s -w&quot; app.go &amp;&amp; tar C app | docker import - myimage:latest<br></code></pre></td></tr></table></figure><ul><li>run go format on CI and compare diffï¼Œç¡®ä¿ä¸€åˆ‡éƒ½æ˜¯ç”Ÿæˆçš„å’Œæ‰¿è¯ºçš„</li><li>ç”¨æœ€æ–°çš„ Go è¿è¡Œ Travis-CIï¼Œç”¨<code>travis 1</code> <a href="https://github.com/travis-ci/travis-build/blob/master/public/version-aliases/go.json"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>æ£€æŸ¥ä»£ç æ ¼å¼æ˜¯å¦æœ‰é”™è¯¯<code>diff -u &lt;(echo -n) &lt;(gofmt -d .)</code></li></ul><h3 id="8-æµ‹è¯•"><a href="#8-æµ‹è¯•" class="headerlink" title="8. æµ‹è¯•"></a>8. æµ‹è¯•</h3><ul><li>æµ‹è¯•åç§°<code>package_test</code>æ¯”<code>package</code>è¦å¥½</li><li><code>go test -short</code>å…è®¸å‡å°‘è¦è¿è¡Œçš„æµ‹è¯•æ•°</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSomething</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> testing.Short() &#123;<br>        t.Skip(<span class="hljs-string">&quot;skipping test in short mode.&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ ¹æ®ç³»ç»Ÿæ¶æ„è·³è¿‡æµ‹è¯•</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">if</span> runtime.GOARM == <span class="hljs-string">&quot;arm&quot;</span> &#123;<br>    t.Skip(<span class="hljs-string">&quot;this doesn&#x27;t work under ARM&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç”¨<code>testing.AllocPerRun</code>è·Ÿè¸ªä½ çš„å†…å­˜åˆ†é…<a href="https://godoc.org/testing#AllocsPerRun"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>å¤šæ¬¡è¿è¡Œä½ çš„åŸºå‡†æµ‹è¯•å¯ä»¥é¿å…å™ªéŸ³<code>go test -test.bench=. -count=20</code></li></ul><h3 id="9-å·¥å…·"><a href="#9-å·¥å…·" class="headerlink" title="9. å·¥å…·"></a>9. å·¥å…·</h3><ul><li>å¿«é€Ÿæ›¿æ¢<code>gofmt -w -l -r &quot;panic(err) -&gt; log.Error(err)&quot;</code>.</li><li><code>go list</code>å…è®¸æ‰¾åˆ°æ‰€æœ‰ç›´æ¥å’Œä¼ é€’çš„ä¾èµ–å…³ç³»<ul><li><code>go list -f &#39;&#123;&#123; .Imports &#125;&#125;&#39; package</code>åˆ—å‡º package ä¸­å¼•å…¥çš„åŒ…</li><li><code>go list -f &#39;&#123;&#123; .Deps &#125;&#125;&#39; package</code>åˆ—å‡º package ä¸­æ‰€æœ‰åŒ…çš„ä¿¡æ¯</li></ul></li><li>å¯¹äºå¿«é€ŸåŸºå‡†æ¯”è¾ƒï¼Œ<a href="https://godoc.org/golang.org/x/perf/cmd/benchstat"><code>benchstat</code></a></li><li><code>go-critic</code> linterï¼Œä»è¿™ä¸ªæ–‡ä»¶ä¸­å¼ºåˆ¶æ‰§è¡Œå‡ æ¡å»ºè®®</li><li><code>go mod why -m &lt;module&gt;</code>å‘Šè¯‰æˆ‘ä»¬ä¸ºä»€ä¹ˆç‰¹å®šçš„æ¨¡å—åœ¨<code>go.mod</code>æ–‡ä»¶ä¸­ã€‚</li><li><code>GOGC=off go build ...</code>åº”è¯¥ä¼šåŠ å¿«æ„å»ºé€Ÿåº¦<a href="https://twitter.com/mvdan_/status/1107579946501853191"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>å†…å­˜åˆ†æå™¨æ¯ 512KB è®°å½•ä¸€æ¬¡åˆ†é…ã€‚ä½ èƒ½é€šè¿‡<code>GODEBUG</code>ç¯å¢ƒå˜é‡å¢åŠ æ¯”ä¾‹ï¼Œæ¥æŸ¥çœ‹ä½ çš„æ–‡ä»¶çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯<a href="https://twitter.com/bboreham/status/1105036740253937664"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><h3 id="10-å…¶å®ƒ"><a href="#10-å…¶å®ƒ" class="headerlink" title="10. å…¶å®ƒ"></a>10. å…¶å®ƒ</h3><ul><li>dump goroutines <a href="https://stackoverflow.com/a/27398062/433041"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>    sigs := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)<br>    signal.Notify(sigs, syscall.SIGQUIT)<br>    buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>)<br>    <span class="hljs-keyword">for</span> &#123;<br>        &lt;-sigs<br>        stacklen := runtime.Stack(buf, <span class="hljs-literal">true</span>)<br>        log.Printf(<span class="hljs-string">&quot;=== received SIGQUIT ===\n*** goroutine dump...\n%s\n*** end\n&quot;</span>  , buf[:stacklen])<br>    &#125;<br>&#125;()<br></code></pre></td></tr></table></figure><ul><li>åœ¨ç¼–è¯‘æœŸæ£€æŸ¥æ¥å£çš„å®ç°</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> _ io.Reader = (*MyFastReader)(<span class="hljs-literal">nil</span>)<br></code></pre></td></tr></table></figure><ul><li><code>len(nil) = 0</code> <a href="https://golang.org/pkg/builtin/#len"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>åŒ¿åç»“æ„ä½“å¾ˆå¥½ç”¨</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> hits <span class="hljs-keyword">struct</span> &#123;<br>    sync.Mutex<br>    n <span class="hljs-type">int</span><br>&#125;<br>hits.Lock()<br>hits.n++<br>hits.Unlock()<br></code></pre></td></tr></table></figure><ul><li><code>httputil.DumpRequest</code>æ˜¯éå¸¸æœ‰ç”¨çš„ä¸œè¥¿ï¼Œä¸è¦è‡ªå·±åˆ›å»º<a href="https://godoc.org/net/http/httputil#DumpRequest"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>è·å¾—è°ƒç”¨å †æ ˆï¼Œå¯ä»¥ä½¿ç”¨<code>runtime.Caller</code> <a href="https://golang.org/pkg/runtime/#Caller"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a></li><li>è¦ marshal æœªçŸ¥çš„ JSONï¼Œä½ å¯ä»¥ marshal ä¸º<code>map[string]interface&#123;&#125;</code></li><li>ä»ä¸€ä¸ª slice ç”Ÿæˆç®€å•çš„éšæœºå…ƒç´ </li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">[]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;one&quot;</span>, <span class="hljs-string">&quot;two&quot;</span>, <span class="hljs-string">&quot;three&quot;</span>&#125;[rand.Intn(<span class="hljs-number">3</span>)]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Archæ—…è¡Œç¬¬ä¸€é›†-å®‰è£…Arch</title>
    <link href="/20220617/archlinux-installation/"/>
    <url>/20220617/archlinux-installation/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å®‰è£… ArchLinuxï¼Œèµ·å› æ˜¯å› ä¸ºæˆ‘çš„è¿™å° XiaoMI Air13 è€å¤è‘£ï¼Œåœ¨ windows ç¯å¢ƒä¸‹è·‘ä¸ª IDEA å¡çš„ä¸è¡Œï¼Œä¸¥é‡å½±å“ç¼–ç¨‹æ•ˆç‡ï¼Œè€Œä¸”åªæœ‰ 8G å†…å­˜ï¼Œå®åœ¨æ˜¯ä¸æƒ³æŠŠå†…å­˜åˆ†é…ç»™ä¸€äº›æ— ç”¨çš„ç¨‹åºã€‚<br>èµ·åˆå¯¹äºç³»ç»Ÿçš„äº†è§£æ˜¯çš®æ¯›çš„çš®æ¯›ï¼Œæ‰€ä»¥æ²¡æœ‰é€‰æ‹©è£¸æœºå®‰è£…ã€‚å½“ç„¶ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç”¨è™šæ‹Ÿæœºæµ‹è¯•ï¼Œå› ä¸ºæˆ‘çš„ç¡¬ç›˜ä¹Ÿä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥æˆ‘èµ·åˆé€‰æ‹©çš„æ˜¯<a href="https://manjaro.org/download/">Manjaro + i3wm </a> çš„ç»„åˆå®‰è£…é•œåƒï¼Œä¸ç”¨è¾“å…¥å‘½ä»¤ï¼Œæœ‰å®‰è£…å¼•å¯¼ç•Œé¢ï¼Œå¾ˆé€‚åˆæ–°æ‰‹ä½¿ç”¨ã€‚å½“ç„¶è¿˜æœ‰è·Ÿå¤šç‚«é…·æ¡Œé¢ç®¡ç†ï¼Œæ¯”å¦‚ GNOMEã€PLASMAã€XFCE ç­‰ï¼Œæˆ‘é€‰æ‹© i3 çš„ç†ç”±æ˜¯å†…å­˜å ç”¨å°ã€‚æ…¢æ…¢çš„æˆ‘ä¹Ÿå–œæ¬¢ä¸Šäº†å¹³é“ºå¼çª—å£ç®¡ç†å™¨ã€‚æœ‰éœ€è¦çš„è¿›å…¥åé¢çš„é“¾æ¥è§‚çœ‹ã€‚<a href="https://manjaro.org/download/"><span class="github-emoji" alias="link" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8">&#x1f517;</span></a><br>Manjaro çš„é…ç½®å¯ä»¥è¯´ç›¸å½“å®Œå–„ï¼Œç›¸å¯¹äº Arch ç¨³å®šäº†ä¸å°‘ï¼ˆæ’å¥å˜´ï¼ŒManjaro æ˜¯ Arch çš„è¡ç”Ÿç‰ˆï¼‰ï¼Œæˆ‘ä¹Ÿç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯åé¢å°±ä¼šæœ‰äº›å°é—®é¢˜ï¼ŒManjaro çš„ Wiki ç›¸å¯¹äº Arch æ¯”è¾ƒå·®ï¼Œæ‰€ä»¥æ¯æ¬¡æœ‰é—®é¢˜å°±ä¼šå» ArchWiki ä¸­å¯»æ‰¾è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯è®¸å¤šç›¸åŒçš„é—®é¢˜å¹¶ä¸èƒ½å¾—åˆ°ç»“å±€ã€‚åŠå¹´åæˆ‘è¿˜æ˜¯é€‰æ‹©é‡è£…äº† Arch ç³»ç»Ÿã€‚<br>ä¸æƒ³å¬æˆ‘é€¼é€¼èµ–èµ–çš„åŒå­¦å¯ä»¥å»<a href="https://www.bilibili.com/video/BV11J411a7Tp">æœ€å…¨ Arch Linux å®‰è£…æ•™ç¨‹â€”â€”æ‰“é€ çœŸæ­£å±äºä½ çš„æ“ä½œç³»ç»Ÿ</a>ï¼Œè¿™ä¸ªè€å“¥çš„è§†é¢‘ç›¸å½“åˆ°ä½ï¼Œé…åˆå¼¹å¹•é£Ÿç”¨æ›´ä½³ã€‚</p><span id="more"></span><h3 id="å‡†å¤‡é•œåƒ"><a href="#å‡†å¤‡é•œåƒ" class="headerlink" title="å‡†å¤‡é•œåƒ"></a>å‡†å¤‡é•œåƒ</h3><ol><li>ä½ éœ€è¦ä¸€ä¸ª U ç›˜ï¼Œ1~2G å°±è¶³å¤Ÿäº†ã€‚å› ä¸ºè¦å°†é•œåƒæ–‡ä»¶å†™å…¥ U ç›˜ï¼Œä½ éœ€è¦å°† U ç›˜ä¸­æœ‰ç”¨çš„ä¿¡æ¯æ–‡ä»¶æ‹·è´å‡ºæ¥ã€‚</li><li>ä¸‹è½½é•œåƒä»¥åŠå†™ç›˜å·¥å…·ã€‚<a href="https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/2022.12.01/archlinux-2022.12.01-x86_64.iso">ArchLinux</a>ï¼Œå¦‚æœä¸‹è½½å¤ªæ…¢ï¼Œå¯åœ¨<a href="https://archlinux.org/download/">Arch Linux Download</a>ä¸­æ‰¾åˆ° China çš„éæ¸…åæºçš„é•œåƒç½‘ç«™ä¸‹è½½ã€‚å†™ç›˜å·¥å…·<a href="https://github.com/pbatard/rufus/archive/v3.21.zip">rufus</a>ã€‚</li><li>æ‰“å¼€ rufusï¼ŒDevice é€‰æ‹© U ç›˜ï¼ŒBoot Selection é€‰æ‹© Arch ISO æ–‡ä»¶ï¼Œå…¶ä»–é»˜è®¤,Start å¾…å†™å…¥å®Œæˆå³å¯ã€‚</li></ol><h3 id="USB-å¯åŠ¨"><a href="#USB-å¯åŠ¨" class="headerlink" title="USB å¯åŠ¨"></a>USB å¯åŠ¨</h3><p>ä¸Šç½‘æŸ¥è¯¢ä¸»æ¿çš„å¼€æœºå¯åŠ¨é¡¹å¿«æ·é”®ï¼Œåƒæˆ‘è¿™å° XiaoMI Air13 æ˜¯ F12ï¼Œå…ˆæ’å…¥ U ç›˜ï¼Œå†è¿›å…¥å¯åŠ¨é¡¹ç®¡ç†ï¼Œå¦‚æœæ²¡æœ‰å‘ç° U ç›˜ï¼Œè¿›å» BIOS é¢æ¿ï¼Œæ‰“å¼€ USB Bootï¼Œå†è¿›å…¥å¯åŠ¨é¡¹ç®¡ç†ï¼Œé€‰æ‹© U ç›˜å¯åŠ¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Arch</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
